!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var i=e();for(var n in i)("object"==typeof exports?exports:t)[n]=i[n]}}(window,function(){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(n,s,function(e){return t[e]}.bind(null,s));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=10)}([function(t,e){t.exports=function(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}},function(t,e,i){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map(function(e){var i=function(t,e){var i=t[1]||"",n=t[3];if(!n)return i;if(e&&"function"==typeof btoa){var s=(r=n,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */"),o=n.sources.map(function(t){return"/*# sourceURL="+n.sourceRoot+t+" */"});return[i].concat(o).concat([s]).join("\n")}var r;return[i].join("\n")}(e,t);return e[2]?"@media "+e[2]+"{"+i+"}":i}).join("")},e.i=function(t,i){"string"==typeof t&&(t=[[null,t,""]]);for(var n={},s=0;s<this.length;s++){var o=this[s][0];null!=o&&(n[o]=!0)}for(s=0;s<t.length;s++){var r=t[s];null!=r[0]&&n[r[0]]||(i&&!r[2]?r[2]=i:i&&(r[2]="("+r[2]+") and ("+i+")"),e.push(r))}},e}},function(t,e,i){var n,s,o={},r=(n=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===s&&(s=n.apply(this,arguments)),s}),a=function(t){var e={};return function(t,i){if("function"==typeof t)return t();if(void 0===e[t]){var n=function(t,e){return e?e.querySelector(t):document.querySelector(t)}.call(this,t,i);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}}(),h=null,c=0,d=[],u=i(8);function l(t,e){for(var i=0;i<t.length;i++){var n=t[i],s=o[n.id];if(s){s.refs++;for(var r=0;r<s.parts.length;r++)s.parts[r](n.parts[r]);for(;r<n.parts.length;r++)s.parts.push(w(n.parts[r],e))}else{var a=[];for(r=0;r<n.parts.length;r++)a.push(w(n.parts[r],e));o[n.id]={id:n.id,refs:1,parts:a}}}}function v(t,e){for(var i=[],n={},s=0;s<t.length;s++){var o=t[s],r=e.base?o[0]+e.base:o[0],a={css:o[1],media:o[2],sourceMap:o[3]};n[r]?n[r].parts.push(a):i.push(n[r]={id:r,parts:[a]})}return i}function p(t,e){var i=a(t.insertInto);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var n=d[d.length-1];if("top"===t.insertAt)n?n.nextSibling?i.insertBefore(e,n.nextSibling):i.appendChild(e):i.insertBefore(e,i.firstChild),d.push(e);else if("bottom"===t.insertAt)i.appendChild(e);else{if("object"!=typeof t.insertAt||!t.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var s=a(t.insertAt.before,i);i.insertBefore(e,s)}}function g(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t);var e=d.indexOf(t);e>=0&&d.splice(e,1)}function f(t){var e=document.createElement("style");if(void 0===t.attrs.type&&(t.attrs.type="text/css"),void 0===t.attrs.nonce){var n=function(){0;return i.nc}();n&&(t.attrs.nonce=n)}return m(e,t.attrs),p(t,e),e}function m(t,e){Object.keys(e).forEach(function(i){t.setAttribute(i,e[i])})}function w(t,e){var i,n,s,o;if(e.transform&&t.css){if(!(o="function"==typeof e.transform?e.transform(t.css):e.transform.default(t.css)))return function(){};t.css=o}if(e.singleton){var r=c++;i=h||(h=f(e)),n=b.bind(null,i,r,!1),s=b.bind(null,i,r,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(i=function(t){var e=document.createElement("link");return void 0===t.attrs.type&&(t.attrs.type="text/css"),t.attrs.rel="stylesheet",m(e,t.attrs),p(t,e),e}(e),n=function(t,e,i){var n=i.css,s=i.sourceMap,o=void 0===e.convertToAbsoluteUrls&&s;(e.convertToAbsoluteUrls||o)&&(n=u(n));s&&(n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(s))))+" */");var r=new Blob([n],{type:"text/css"}),a=t.href;t.href=URL.createObjectURL(r),a&&URL.revokeObjectURL(a)}.bind(null,i,e),s=function(){g(i),i.href&&URL.revokeObjectURL(i.href)}):(i=f(e),n=function(t,e){var i=e.css,n=e.media;n&&t.setAttribute("media",n);if(t.styleSheet)t.styleSheet.cssText=i;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(i))}}.bind(null,i),s=function(){g(i)});return n(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;n(t=e)}else s()}}t.exports=function(t,e){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(e=e||{}).attrs="object"==typeof e.attrs?e.attrs:{},e.singleton||"boolean"==typeof e.singleton||(e.singleton=r()),e.insertInto||(e.insertInto="head"),e.insertAt||(e.insertAt="bottom");var i=v(t,e);return l(i,e),function(t){for(var n=[],s=0;s<i.length;s++){var r=i[s];(a=o[r.id]).refs--,n.push(a)}t&&l(v(t,e),e);for(s=0;s<n.length;s++){var a;if(0===(a=n[s]).refs){for(var h=0;h<a.parts.length;h++)a.parts[h]();delete o[a.id]}}}};var x,y=(x=[],function(t,e){return x[t]=e,x.filter(Boolean).join("\n")});function b(t,e,i,n){var s=i?"":n.css;if(t.styleSheet)t.styleSheet.cssText=y(e,s);else{var o=document.createTextNode(s),r=t.childNodes;r[e]&&t.removeChild(r[e]),r.length?t.insertBefore(o,r[e]):t.appendChild(o)}}},function(t,e,i){"use strict";(function(t){var i=function(){if("undefined"!=typeof Map)return Map;function t(t,e){var i=-1;return t.some(function(t,n){return t[0]===e&&(i=n,!0)}),i}return function(){function e(){this.__entries__=[]}return Object.defineProperty(e.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),e.prototype.get=function(e){var i=t(this.__entries__,e),n=this.__entries__[i];return n&&n[1]},e.prototype.set=function(e,i){var n=t(this.__entries__,e);~n?this.__entries__[n][1]=i:this.__entries__.push([e,i])},e.prototype.delete=function(e){var i=this.__entries__,n=t(i,e);~n&&i.splice(n,1)},e.prototype.has=function(e){return!!~t(this.__entries__,e)},e.prototype.clear=function(){this.__entries__.splice(0)},e.prototype.forEach=function(t,e){void 0===e&&(e=null);for(var i=0,n=this.__entries__;i<n.length;i++){var s=n[i];t.call(e,s[1],s[0])}},e}()}(),n="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,s=void 0!==t&&t.Math===Math?t:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),o="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(s):function(t){return setTimeout(function(){return t(Date.now())},1e3/60)},r=2;var a=20,h=["top","right","bottom","left","width","height","size","weight"],c="undefined"!=typeof MutationObserver,d=function(){function t(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(t,e){var i=!1,n=!1,s=0;function a(){i&&(i=!1,t()),n&&c()}function h(){o(a)}function c(){var t=Date.now();if(i){if(t-s<r)return;n=!0}else i=!0,n=!1,setTimeout(h,e);s=t}return c}(this.refresh.bind(this),a)}return t.prototype.addObserver=function(t){~this.observers_.indexOf(t)||this.observers_.push(t),this.connected_||this.connect_()},t.prototype.removeObserver=function(t){var e=this.observers_,i=e.indexOf(t);~i&&e.splice(i,1),!e.length&&this.connected_&&this.disconnect_()},t.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},t.prototype.updateObservers_=function(){var t=this.observers_.filter(function(t){return t.gatherActive(),t.hasActive()});return t.forEach(function(t){return t.broadcastActive()}),t.length>0},t.prototype.connect_=function(){n&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),c?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},t.prototype.disconnect_=function(){n&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},t.prototype.onTransitionEnd_=function(t){var e=t.propertyName,i=void 0===e?"":e;h.some(function(t){return!!~i.indexOf(t)})&&this.refresh()},t.getInstance=function(){return this.instance_||(this.instance_=new t),this.instance_},t.instance_=null,t}(),u=function(t,e){for(var i=0,n=Object.keys(e);i<n.length;i++){var s=n[i];Object.defineProperty(t,s,{value:e[s],enumerable:!1,writable:!1,configurable:!0})}return t},l=function(t){return t&&t.ownerDocument&&t.ownerDocument.defaultView||s},v=x(0,0,0,0);function p(t){return parseFloat(t)||0}function g(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];return e.reduce(function(e,i){return e+p(t["border-"+i+"-width"])},0)}function f(t){var e=t.clientWidth,i=t.clientHeight;if(!e&&!i)return v;var n=l(t).getComputedStyle(t),s=function(t){for(var e={},i=0,n=["top","right","bottom","left"];i<n.length;i++){var s=n[i],o=t["padding-"+s];e[s]=p(o)}return e}(n),o=s.left+s.right,r=s.top+s.bottom,a=p(n.width),h=p(n.height);if("border-box"===n.boxSizing&&(Math.round(a+o)!==e&&(a-=g(n,"left","right")+o),Math.round(h+r)!==i&&(h-=g(n,"top","bottom")+r)),!function(t){return t===l(t).document.documentElement}(t)){var c=Math.round(a+o)-e,d=Math.round(h+r)-i;1!==Math.abs(c)&&(a-=c),1!==Math.abs(d)&&(h-=d)}return x(s.left,s.top,a,h)}var m="undefined"!=typeof SVGGraphicsElement?function(t){return t instanceof l(t).SVGGraphicsElement}:function(t){return t instanceof l(t).SVGElement&&"function"==typeof t.getBBox};function w(t){return n?m(t)?function(t){var e=t.getBBox();return x(0,0,e.width,e.height)}(t):f(t):v}function x(t,e,i,n){return{x:t,y:e,width:i,height:n}}var y=function(){function t(t){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=x(0,0,0,0),this.target=t}return t.prototype.isActive=function(){var t=w(this.target);return this.contentRect_=t,t.width!==this.broadcastWidth||t.height!==this.broadcastHeight},t.prototype.broadcastRect=function(){var t=this.contentRect_;return this.broadcastWidth=t.width,this.broadcastHeight=t.height,t},t}(),b=function(){return function(t,e){var i,n,s,o,r,a,h,c=(n=(i=e).x,s=i.y,o=i.width,r=i.height,a="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,h=Object.create(a.prototype),u(h,{x:n,y:s,width:o,height:r,top:s,right:n+o,bottom:r+s,left:n}),h);u(this,{target:t,contentRect:c})}}(),E=function(){function t(t,e,n){if(this.activeObservations_=[],this.observations_=new i,"function"!=typeof t)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=t,this.controller_=e,this.callbackCtx_=n}return t.prototype.observe=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(t instanceof l(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var e=this.observations_;e.has(t)||(e.set(t,new y(t)),this.controller_.addObserver(this),this.controller_.refresh())}},t.prototype.unobserve=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(t instanceof l(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var e=this.observations_;e.has(t)&&(e.delete(t),e.size||this.controller_.removeObserver(this))}},t.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},t.prototype.gatherActive=function(){var t=this;this.clearActive(),this.observations_.forEach(function(e){e.isActive()&&t.activeObservations_.push(e)})},t.prototype.broadcastActive=function(){if(this.hasActive()){var t=this.callbackCtx_,e=this.activeObservations_.map(function(t){return new b(t.target,t.broadcastRect())});this.callback_.call(t,e,t),this.clearActive()}},t.prototype.clearActive=function(){this.activeObservations_.splice(0)},t.prototype.hasActive=function(){return this.activeObservations_.length>0},t}(),C="undefined"!=typeof WeakMap?new WeakMap:new i,P=function(){return function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var i=d.getInstance(),n=new E(e,i,this);C.set(this,n)}}();["observe","unobserve","disconnect"].forEach(function(t){P.prototype[t]=function(){var e;return(e=C.get(this))[t].apply(e,arguments)}});var N=void 0!==s.ResizeObserver?s.ResizeObserver:P;e.a=N}).call(this,i(6))},function(t,e,i){var n=i(7);"string"==typeof n&&(n=[[t.i,n,""]]);var s={hmr:!0,transform:void 0,insertInto:void 0};i(2)(n,s);n.locals&&(t.exports=n.locals)},function(t,e,i){var n=i(9);"string"==typeof n&&(n=[[t.i,n,""]]);var s={hmr:!0,transform:void 0,insertInto:void 0};i(2)(n,s);n.locals&&(t.exports=n.locals)},function(t,e){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e,i){(e=t.exports=i(1)(!1)).push([t.i,".ContextMenu-2I-gA {\n  background: white;\n  position: fixed;\n  width: 160px;\n  min-height: 160px;\n  border-radius: 5px;\n  z-index: 9999;\n  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.175);\n  border: 1px solid rgba(0, 0, 0, 0.15);\n  font-size: 14px;\n  padding: 10px 0;\n  color: #666;\n}\n.ContextMenu-2I-gA .item {\n  height: 26px;\n  line-height: 26px;\n  padding: 0 20px;\n  cursor: pointer;\n}\n.ContextMenu-2I-gA .item:hover {\n  background: #f6f6f6;\n  color: #0796e9;\n}\n",""]),e.locals={menu:"ContextMenu-2I-gA"}},function(t,e){t.exports=function(t){var e="undefined"!=typeof window&&window.location;if(!e)throw new Error("fixUrls requires window.location");if(!t||"string"!=typeof t)return t;var i=e.protocol+"//"+e.host,n=i+e.pathname.replace(/\/[^\/]*$/,"/");return t.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(t,e){var s,o=e.trim().replace(/^"(.*)"$/,function(t,e){return e}).replace(/^'(.*)'$/,function(t,e){return e});return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(o)?t:(s=0===o.indexOf("//")?o:0===o.indexOf("/")?i+o:n+o.replace(/^\.\//,""),"url("+JSON.stringify(s)+")")})}},function(t,e,i){(e=t.exports=i(1)(!1)).push([t.i,".canvas-1iCxA {\n  width: 100%;\n  height: 100%;\n  position: relative;\n}\n.canvas-1iCxA > div,\n.canvas-1iCxA canvas {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  top: 0;\n  left: 0;\n  overflow: hidden;\n}\n.canvas-1iCxA .hidden {\n  display: none !important;\n}\n",""]),e.locals={topology:"canvas-1iCxA"}},function(t,e,i){"use strict";i.r(e);var n=i(0),s=i.n(n);class o{constructor(){s()(this,"events",{})}on(t,e){this.events[t]=this.events[t]||[],this.events[t].push(e)}off(t,e){if(!this.events[t])return;const i=this.events[t].findIndex(t=>t===e);this.events[t].splice(i,1)}emit(t,e){this.events[t]&&this.events[t].forEach(t=>{t(e)})}clear(){Object.keys(this.events).forEach(t=>{delete this.events[t]})}}class r{static copy(t){return t.clone()}constructor(t=0,e=0){s()(this,"x",void 0),s()(this,"y",void 0),this.x=t,this.y=e}get magnitude(){return this.getMagnitude()}getMagnitude(){return 0===this.x&&0===this.y?1e-9:Math.sqrt(this.x*this.x+this.y*this.y)}add(t){return this.x+=t.x,this.y+=t.y,this}substract(t){return this.x-=t.x,this.y-=t.y,this}dotProduct(t){return this.x*t.x+this.y*t.y}crossProduct(t){return this.x*t.y-this.y*t.x}scale(t){return this.x*=t,this.y*=t,this}edge(t){return this.clone().substract(t)}perpendicular(){return new r(this.y,-this.x)}normalize(){const t=this.getMagnitude();return new r(this.x/t,this.y/t)}normal(){return this.perpendicular().normalize()}cosAngle(t){return this.dotProduct(t)/(this.magnitude*t.magnitude)}angle(t){return Math.acos(this.cosAngle(t))}xAxisAngle(){const t=this.angle(r.xAxis);return this.y>0?t:-t}rotate(t){const{x:e,y:i}=this;return this.x=e*Math.cos(t)-i*Math.sin(t),this.y=e*Math.sin(t)+i*Math.cos(t),this}project(t){const e=this.dotProduct(t)/t.magnitude;return t.normalize().scale(e)}equal(t){return this.x===t.x&&this.y===t.y}distance(t){return this.edge(t).magnitude}copy(t){return this.x=t.x,this.y=t.y,this}clone(){return new r(this.x,this.y)}}s()(r,"xAxis",new r(1,0)),s()(r,"yAxis",new r(0,1));var a=r,h=i(3);let c=1;var d=class{get visible(){return this._visible}set visible(t){this._visible=t}get text(){return this._text}set text(t){this._text=t,this.canvas&&(this.canvas.repaint=!0)}get miniMapVisible(){return this.visible}constructor(t){s()(this,"canvas",void 0),s()(this,"active",!1),s()(this,"_visible",void 0),s()(this,"_text",void 0),s()(this,"zIndex",void 0),s()(this,"isUpdate",!0),s()(this,"graphId",c++),s()(this,"data",null),s()(this,"style",{color:"#29c1f8",activeColor:"#e96160",lineWidth:2}),s()(this,"renderSign",void 0),this._visible=t.visible||!0,this._text=t.text||"",this.zIndex=t.zIndex||0,this.data=t.data}isInRect(t){return!1}isWrappedInRect(t){return!1}isWrappedInCircle(){return!1}render(t){}update(t){}destroy(){}beforeDestroy(){}exportJson(){}};class u extends d{getPosition(){return this.position}get visible(){return!!this._visible&&!!(!this.parent||this.parent.visible&&this.parent.isExpanded)}set visible(t){this._visible=t}get miniMapVisible(){return!!(!this.parent||this.parent.miniMapVisible&&this.parent.isExpanded)}get text(){return this._text}set text(t){this._text=t,this.render(),this.canvas&&(this.canvas.repaint=!0)}constructor(t){super(t),s()(this,"id",void 0),s()(this,"position",void 0),s()(this,"mounted",!1),s()(this,"renderType",void 0),s()(this,"shapeType",void 0),s()(this,"isGroup",!1),s()(this,"isExpanded",!0),s()(this,"canResize",!1),s()(this,"children",[]),s()(this,"parent",void 0),s()(this,"edges",[]),this.position=new a(t.x,t.y),this.id=t.id}translate(t){this.position.add(t),this.isUpdate=!0,this.children.forEach(e=>{e.translate(t)})}addEdge(t){this.edges.find(e=>e===t)||this.edges.push(t)}removeEdge(t){const e=this.edges.findIndex(e=>e===t);e>-1&&this.edges.splice(e,1)}addChild(t){if(t.hasDescendant(this))return;if(this.hasChild(t))return;let e=this.children.length-1,i=this.children[e];for(;i;){if(i.zIndex<=t.zIndex)return this.addChildAt(t,e+1);e--,i=this.children[e]}return this.addChildAt(t,0)}addChildAt(t,e){return e>=0&&e<=this.children.length?(t.parent&&t.parent.removeChild(t,!1),t.parent=this,this.children.splice(e,0,t),this.canvas&&(t.canvas=this.canvas,t.render(),t.getDescendantBF(t=>{t.canvas=this.canvas,t.render()})),t):void 0}removeChild(t,e=!0){const i=this.children.findIndex(e=>e===t);return-1!==i&&(e&&t.destroy(),t.canvas=void 0,this.children.splice(i,1),!0)}removeAllChild(t=!0){[...this.children].forEach(e=>{this.removeChild(e,t)})}hasChild(t){return!!this.children.find(e=>e===t)}hasDescendant(t){let e=!1;return this.getDescendantBF(i=>{if(i===t)return e=!0}),e}hasActiveAncestor(){return!!this.parent&&(this.parent.active||this.parent.hasActiveAncestor())}getActiveChild(){return this.children.filter(t=>t.active)}getActiveDescendant(){const t=[];return this.getDescendantBF(e=>{e.active&&t.push(e)}),t}getDescendantDF(t){let e=!1;const i=[];return function t(n){for(let s=this.children.length-1;s>=0;s--){const o=this.children[s];if(t.call(o,n),e)return i;if(i.push(o),n&&n(o))return e=!0,i}return i}.call(this,t)}getDescendantBF(t){const e=[],i=[...this.children];for(;i.length;){const n=i.shift();if(e.push(n),i.push(...n.children),t&&t(n))break}return e}get root(){return this.parent?this.parent.root:this}get depth(){return this.parent?this.parent.depth+1:0}get firstChild(){return this.children[0]}get lastChild(){return this.children[this.children.length-1]}mount(){}unmount(){}destroy(){this.removeAllChild(),this.beforeDestroy(),this.unmount()}}var l=u;var v=class extends l{constructor(t){super(t),s()(this,"maxDepth",!1),s()(this,"renderType","NONE"),s()(this,"shapeType","circle"),s()(this,"radius",1)}get vertexes(){return this.boundingRect}get boundingRect(){const{x:t,y:e}=this.position;return[new a(t-this.radius,e-this.radius),new a(t+this.radius,e-this.radius),new a(t+this.radius,e+this.radius),new a(t-this.radius,e+this.radius)]}get boundingJoinPoints(){const{x:t,y:e}=this.position;return[new a(t,e-this.radius),new a(t+this.radius,e),new a(t,e+this.radius),new a(t-this.radius,e)]}get joinPoint(){return this.position}get centerPoint(){return this.position}get depth(){return this.maxDepth?Number.MAX_SAFE_INTEGER:this.parent?this.parent.depth+1:0}isInRect(){return!1}isPointIn(){return!1}render(){}destroy(){}updatePosition(){}updateRender(){}drawThumbnail(){}};function p(t,e){}class g{constructor(){s()(this,"onInstall",p),s()(this,"onUninstall",p),s()(this,"onUpdate",p)}handleEvent(t,e){}}var f=g;class m extends f{constructor(...t){super(...t),s()(this,"minDragDistance",3),s()(this,"moveNodes",[]),s()(this,"mousedown",!1),s()(this,"lastCoordinate",new a),s()(this,"onMouseDown",t=>{const e=t.getActiveNodes();e.length?this.moveNodes=[...e]:this.moveNodes=[...t.rootNode.children],this.mousedown=!0,this.lastCoordinate.copy(t.mousedownPosition)}),s()(this,"onMouseMove",t=>{if(!this.mousedown)return;if(a.copy(t.mousemovePosition).substract(t.mousedownPosition).magnitude<this.minDragDistance)return;const e=a.copy(t.mousemovePosition).substract(this.lastCoordinate);this.lastCoordinate.copy(t.mousemovePosition);const i=e.scale(1/t.canvasScale);this.moveNodes.forEach(t=>{t.translate(i)}),t.repaint=!0}),s()(this,"onMouseUp",t=>{if(1===this.moveNodes.length){const e=this.moveNodes[0];let i=!1;t.rootNode.getDescendantDF(t=>{if(t.visible&&t!==e&&t.isGroup&&!e.hasDescendant(t))return e.isWrappedInRect(t.boundingRect)?(t.addChild(e),i=!0):void 0}),i||t.rootNode.addChild(e)}this.moveNodes=[],this.mousedown=!1})}handleEvent(t,e){switch(e.type){case"mousedown":this.onMouseDown(t);break;case"mousemove":this.onMouseMove(t);break;case"mouseup":this.onMouseUp(t)}}}const w=new m;var x=m;class y extends f{constructor(...t){super(...t),s()(this,"onDrop",(t,e)=>{const i=e;t.eventEmitter.emit("canvas:drop",{coordinate:t.viewportToPixelCoordinate(new a(i.clientX,i.clientY)),dataTransfer:i.dataTransfer})}),s()(this,"onDragOver",(t,e)=>{e.preventDefault()})}handleEvent(t,e){switch(e.type){case"drop":this.onDrop(t,e);break;case"dragover":this.onDragOver(t,e)}}}const b=new y;var E=y;class C extends f{constructor(...t){super(...t),s()(this,"minDragDistance",3),s()(this,"mouseDown",!1),s()(this,"move",!1),s()(this,"lastCoordinate",new a),s()(this,"onMouseDown",t=>{this.mouseDown=!0,this.lastCoordinate.copy(t.mousedownPosition)}),s()(this,"onMouseMove",t=>{if(!this.mouseDown)return;if(a.copy(t.mousemovePosition).substract(t.mousedownPosition).magnitude<this.minDragDistance)return;const e=a.copy(t.mousemovePosition).substract(this.lastCoordinate);this.lastCoordinate.copy(t.mousemovePosition),this.move=!0;const i=e.scale(1/t.canvasScale);t.rootNode.translate(i),t.repaint=!0}),s()(this,"onMouseUp",t=>{this.mouseDown=!1,this.move&&(t.eventEmitter.emit("interaction:canvasMoveEnd"),this.move=!1)})}handleEvent(t,e){switch(e.type){case"mousedown":this.onMouseDown(t);break;case"mousemove":this.onMouseMove(t);break;case"mouseup":this.onMouseUp(t)}}}const P=new C;var N=C;class M extends f{constructor(...t){super(...t),s()(this,"onWheel",(t,e)=>{const{deltaY:i,clientX:n,clientY:s}=e;e.preventDefault(),i>0?t.zoomOut(new a(n,s)):t.zoomIn(new a(n,s))})}handleEvent(t,e){switch(e.type){case"wheel":this.onWheel(t,e)}}}const A=new M;var I=M;class _ extends d{constructor(t){super(t),s()(this,"renderType","CANVAS"),s()(this,"targetNode",void 0),s()(this,"sourceNode",void 0),this.targetNode=t.targetNode,this.sourceNode=t.sourceNode}getTargetNode(){let t=this.targetNode.parent,e=!0;for(;t;)t.isExpanded||(e=!1),t=t.parent;if(e)return this.targetNode;{let t=this.targetNode;for(;!t.visible&&t.parent&&"NONE"!==t.parent.renderType;)t=t.parent;return t}}getSourceNode(){let t=this.sourceNode.parent,e=!0;for(;t;)t.isExpanded||(e=!1),t=t.parent;if(e)return this.sourceNode;{let t=this.sourceNode;for(;!t.visible&&t.parent&&"NONE"!==t.parent.renderType;)t=t.parent;return t}}}class T{static isPointInRect(t,e,i,n){return!(t.x<e.x)&&(!(t.y<e.y)&&(!(t.x>e.x+i)&&!(t.y>e.y+n)))}static isPointInCircle(t,e,i){return a.copy(e).substract(t).magnitude<=i}static isPointInTriangle(t,e,i,n){const s=a.copy(e).substract(t),o=a.copy(i).substract(t),r=a.copy(n).substract(t),h=s.crossProduct(o)<0,c=o.crossProduct(r)<0,d=r.crossProduct(s)<0;return h===c&&c===d}static isPointInPolygon(t,e){if(e.length<3)return!1;for(let i=2;i<e.length;i++)if(T.isPointInTriangle(t,e[0],e[i-1],e[i]))return!0;return!1}static isPointInLineSegment(t,e,i=.01){const n=e[0],s=e[1],o=a.copy(t).substract(n),r=a.copy(t).substract(s),h=a.copy(n).substract(s);return o.magnitude+r.magnitude-h.magnitude<i}static isPointInPolyline(t,e,i=.01){const n=e.length;if(n<2)return!1;for(let s=1;s<n;s++)if(T.isPointInLineSegment(t,[e[s-1],e[s]],i))return!0;return!1}static isIntersect(t,e){const i=t[0],n=t[1],s=e[0],o=e[1];if(T.isPointInLineSegment(i,e))return!0;if(T.isPointInLineSegment(n,e))return!0;if(T.isPointInLineSegment(s,t))return!0;if(T.isPointInLineSegment(o,t))return!0;const r=a.copy(s).substract(i),h=a.copy(o).substract(i),c=a.copy(s).substract(n),d=a.copy(o).substract(n);if(r.crossProduct(h)<0===c.crossProduct(d)<0)return!1;const u=a.copy(i).substract(s),l=a.copy(n).substract(s),v=a.copy(i).substract(o),p=a.copy(n).substract(o);return u.crossProduct(l)<0!==v.crossProduct(p)<0}static getLineIntersect(t,e){const i=t[0],n=t[1],s=e[0],o=e[1],r=a.copy(n).substract(i),h=a.copy(o).substract(s).perpendicular(),c=s.project(h),d=i.project(h),u=n.project(h),l=a.copy(c).substract(d),v=a.copy(u).substract(c),p=r.magnitude*l.magnitude/(l.magnitude+v.magnitude);return r.normalize().scale(p).add(i)}static getLinePoint(t,e){const i=t.length;if(i<2)return null;e>1&&(e=1),e<0&&(e=0);const n=T.getPolyLineLength(t)*e;let s=0;for(let e=1;e<i;e++)if((s+=t[e].distance(t[e-1]))>=n){const i=s-n;return a.copy(t[e]).add(a.copy(t[e-1]).substract(t[e]).normalize().scale(i))}return new a(0,0)}static getPolyLineLength(t){const e=t.length;if(e<2)return 0;let i=0;for(let n=1;n<e;n++)i+=t[n].distance(t[n-1]);return i}}var S=T;var R=class{constructor(){s()(this,"position",new a),s()(this,"offset",new a),s()(this,"rotate",0)}};class D extends R{constructor(t){super(),s()(this,"width",void 0),s()(this,"height",void 0),this.width=t.width,this.height=t.height}render(t){const{x:e,y:i}=this.position,{x:n,y:s}=this.offset;t.beginPath(),t.save(),t.translate(e,i),t.rotate(this.rotate),t.translate(n,s),t.moveTo(0,0),t.lineTo(-this.height,+this.width/2),t.lineTo(-this.height,-this.width/2),t.closePath(),t.fill(),t.restore()}isPointIn(t){const e=new a(0,0).add(this.offset).rotate(this.rotate),i=new a(-this.height,+this.width/2).add(this.offset).rotate(this.rotate),n=new a(-this.height,-this.width/2).add(this.offset).rotate(this.rotate);return S.isPointInTriangle(a.copy(t).substract(this.position),e,i,n)}}var k=D;class O extends R{constructor(t){super(),s()(this,"width",void 0),s()(this,"height",void 0),s()(this,"fillStyle",""),s()(this,"strokeStyle",""),this.width=t.width,this.height=t.height}render(t){const{x:e,y:i}=this.position,{x:n,y:s}=this.offset;t.beginPath(),t.save(),t.translate(e,i),t.rotate(this.rotate),t.translate(n,s),this.fillStyle&&(t.fillStyle=this.fillStyle,t.fillRect(-this.width/2,-this.height/2,this.width,this.height)),this.strokeStyle&&(t.strokeStyle=this.strokeStyle,t.strokeRect(-this.width/2,-this.height/2,this.width,this.height)),t.restore()}isPointIn(t){const e=new a(-this.width/2,-this.height/2).add(this.offset).rotate(this.rotate),i=new a(-this.width/2,this.height/2).add(this.offset).rotate(this.rotate),n=new a(this.width/2,this.height/2).add(this.offset).rotate(this.rotate),s=new a(this.width/2,-this.height/2).add(this.offset).rotate(this.rotate);return S.isPointInPolygon(a.copy(t).substract(this.position),[e,i,n,s])}}var W=O;const L=document.createElement("canvas").getContext("2d");class H extends R{constructor(t){super(),s()(this,"text",void 0),s()(this,"font","14px sans-serif"),s()(this,"backgroundColor",""),s()(this,"textAlign","center"),s()(this,"textBaseline","middle"),s()(this,"rectElement",new W({width:0,height:0})),this.text=t}render(t){const{x:e,y:i}=this.position,{x:n,y:s}=this.offset;t.save(),this.backgroundColor&&(this.rectElement.width=this.width,this.rectElement.height=this.height,this.rectElement.fillStyle=this.backgroundColor,this.rectElement.position.copy(this.position),this.rectElement.offset.copy(this.offset),this.rectElement.rotate=this.rotate,this.rectElement.render(t)),t.font=this.font,t.textAlign=this.textAlign,t.textBaseline=this.textBaseline,t.translate(e,i),t.rotate(this.rotate),t.fillText(this.text,n,s),t.restore()}get width(){return L.font=this.font,L.textAlign=this.textAlign,L.textBaseline=this.textBaseline,L.measureText(this.text).width}get height(){return L.font=this.font,parseInt(L.font)}isPointIn(t){const e=this.width,i=this.height,n=new a(-e/2,-i/2).add(this.offset).rotate(this.rotate),s=new a(-e/2,i/2).add(this.offset).rotate(this.rotate),o=new a(e/2,i/2).add(this.offset).rotate(this.rotate),r=new a(e/2,-i/2).add(this.offset).rotate(this.rotate);return S.isPointInPolygon(a.copy(t).substract(this.position),[n,s,o,r])}}var U=H;const B=new a;class z extends R{constructor(...t){super(...t),s()(this,"points",[]),s()(this,"lineWidth",1)}render(t){if(this.points.length<2)return;const{x:e,y:i}=this.offset;t.save(),t.lineWidth=this.lineWidth,t.beginPath(),t.translate(e,i),this.points.forEach((e,i)=>{const{x:n,y:s}=e;0===i?t.moveTo(n,s):t.lineTo(n,s)}),t.stroke(),t.restore()}isPointIn(t){return S.isPointInPolyline(B.copy(t).substract(this.offset),this.points,.1)}}var j=z;class F{constructor(){s()(this,"current",0),s()(this,"delta",0)}update(){const t=("undefined"==typeof performance?Date:performance).now();this.delta=this.current?t-this.current:0,this.current=t}getDelta(){return this.delta}}const G=new F;var J=class{constructor(){s()(this,"path",[]),s()(this,"element",null),s()(this,"duration",1e3),s()(this,"progress",0),s()(this,"_lastPoint",null)}update(){if(!this.element)return;if(this.duration<=0)return;const t=G.getDelta();this.progress+=t/this.duration,this.progress%=1;const e=S.getLinePoint(this.path,this.progress);if(e){if(this._lastPoint){const t=e.clone().substract(this._lastPoint).xAxisAngle();this.element.rotate=t,this.element.position.copy(e)}this._lastPoint=e}}render(t){this.element&&(this.duration<=0||this.element.render(t))}};const $={width:8,height:10};class V extends _{constructor(t){super(t),s()(this,"dash",void 0),s()(this,"arrow",void 0),s()(this,"doubleArrow",void 0),s()(this,"begin",void 0),s()(this,"end",void 0),s()(this,"lineElement",new j),s()(this,"sourceArrowElement",new k($)),s()(this,"targetArrowElement",new k($)),s()(this,"textElement",new U("")),s()(this,"animate",new J),this.dash=t.dash||!1,this.arrow=t.arrow||!1,this.doubleArrow=t.doubleArrow||!1,this.textElement.text=this.text,this.textElement.offset.y=-10,this.style.lineWidth=2,this.animate.element=t.animateElement||null,this.animate.duration=t.animateDuration||0}isInRect(){return!0}isPointIn(){const t=this.getTargetNode(),e=this.getSourceNode();if(!t.visible&&!e.visible)return!1;const{canvas:i}=this;if(!i)return!1;if(!i.nativeEvent)return!1;if(!this.begin||!this.end)return!1;const n=i.nativeEvent,s=new a(n.clientX,n.clientY),o=i.viewportToPixelCoordinate(s);if(this.lineElement.isPointIn(o))return!0;if(this.doubleArrow){if(this.sourceArrowElement.isPointIn(o))return!0;if(this.targetArrowElement.isPointIn(o))return!0}else if(this.arrow&&this.targetArrowElement.isPointIn(o))return!0;return!(!this.text||!this.textElement.isPointIn(o))}render(t){if(!(t=t||this.canvas&&this.canvas.graphCanvasCtx))return;const e=this.getTargetNode(),i=this.getSourceNode();if(i.visible||e.visible){const n=i.centerPoint,s=e.centerPoint,o=[n,s];if(this.begin="rect"===i.shapeType?X(o,i.boundingRect):Y(n,i.radius,s),!this.begin)return;if(this.end="rect"===e.shapeType?X(o,e.boundingRect):Y(s,e.radius,n),!this.end)return;const r=a.copy(this.end).substract(this.begin);t.save(),t.strokeStyle=this.active?this.style.activeColor:this.style.color,t.fillStyle=this.active?this.style.activeColor:this.style.color,this.dash&&t.setLineDash([4,4]),this.lineElement.lineWidth=this.style.lineWidth,this.lineElement.points=[this.begin,this.end],this.lineElement.render(t);const h=r.xAxisAngle();if(this.text){this.textElement.text=this.text;const e=a.copy(this.begin).add(a.copy(r).scale(.5));this.textElement.position.copy(e),this.textElement.rotate=-Math.PI/2<=h&&h<Math.PI/2?h:h-Math.PI,this.textElement.render(t)}this.doubleArrow?(this.sourceArrowElement.position.copy(this.begin),this.sourceArrowElement.rotate=h+Math.PI,this.sourceArrowElement.render(t),this.targetArrowElement.position.copy(this.end),this.targetArrowElement.rotate=h,this.targetArrowElement.render(t)):this.arrow&&(this.targetArrowElement.position.copy(this.end),this.targetArrowElement.rotate=h,this.targetArrowElement.render(t)),this.animate.path=[this.begin,this.end],this.animate.update(),this.animate.render(t),t.restore()}}drawThumbnail(t){this.render(t)}}function X(t,e){const i=e.length;for(let n=0;n<i;n++){const s=e[n],o=n===i-1?e[0]:e[n+1];if(S.isIntersect(t,[s,o]))return S.getLineIntersect([s,o],t)}}function Y(t,e,i){const n=a.copy(i).substract(t);if(n.magnitude<e)return;const s=n.xAxisAngle();return a.copy(t).add(new a(e*Math.cos(s),e*Math.sin(s)))}var q=V;class Z extends f{constructor(t){super(),s()(this,"targetNode",void 0),s()(this,"sourceNode",void 0),s()(this,"edge",void 0),s()(this,"text",""),s()(this,"arrow",!1),s()(this,"dash",!1),s()(this,"doubleArrow",!1),s()(this,"onMouseUp",t=>{this.edge?(t.rootNode.getDescendantDF(t=>{if(t.isPointIn())return this.targetNode=t,!0}),this.targetNode&&this.sourceNode&&this.targetNode!==this.sourceNode&&!this.targetNode.hasDescendant(this.sourceNode)&&!this.sourceNode.hasDescendant(this.targetNode)?(this.edge.targetNode=this.targetNode,this.targetNode.addEdge(this.edge),t.virtualNode.removeEdge(this.edge),this.targetNode.isUpdate=!0,this.edge=void 0,this.targetNode=void 0,this.sourceNode=void 0):(t.removeEdge(this.edge),this.edge=void 0,this.targetNode=void 0,this.sourceNode=void 0)):(t.rootNode.getDescendantDF(t=>{if(t.isPointIn())return this.sourceNode=t,!0}),this.sourceNode&&(this.edge=new q({sourceNode:this.sourceNode,targetNode:t.virtualNode,arrow:this.arrow,text:this.text,dash:this.dash,doubleArrow:this.doubleArrow}),t.addEdge(this.edge))),t.repaint=!0}),s()(this,"onMouseMove",t=>{t.virtualNode.position=t.viewportToPixelCoordinate(t.mousemovePosition),this.sourceNode&&(t.virtualNode.isUpdate=!0),t.repaint=!0}),s()(this,"onUninstall",t=>{this.edge&&(t.removeEdge(this.edge),this.edge=void 0,this.targetNode=void 0,this.sourceNode=void 0),t.repaint=!0}),t&&(this.text=t.text||"",this.arrow=t.arrow||!1,this.dash=t.dash||!1,this.doubleArrow=t.doubleArrow||!1)}handleEvent(t,e){switch(e.type){case"mouseup":this.onMouseUp(t);break;case"mousemove":this.onMouseMove(t)}}}const K=new Z;var Q=Z;const tt=new r,et=new r,it=(new r,{width:8,height:10});class nt extends _{constructor(t){super(t),s()(this,"dash",void 0),s()(this,"arrow",void 0),s()(this,"doubleArrow",void 0),s()(this,"arrowStart",void 0),s()(this,"middlePoints",[]),s()(this,"centerPoint",null),s()(this,"sourceJoinPoint",void 0),s()(this,"targetJoinPoint",void 0),s()(this,"sourceArrowElement",new k(it)),s()(this,"targetArrowElement",new k(it)),s()(this,"textElement",new U("")),s()(this,"lineElement",new j),s()(this,"animate",new J),s()(this,"isInRect",()=>!0),this.dash=t.dash||!1,this.arrow=t.arrow||!1,this.doubleArrow=t.doubleArrow||!1,this.style.lineWidth=2,this.textElement.text=this.text,this.animate.element=t.animateElement||null,this.animate.duration=t.animateDuration||0}isPointIn(){const t=this.getSourceNode(),e=this.getTargetNode();if(!t.visible&&!e.visible)return!1;const{canvas:i}=this;if(!i)return!1;if(!i.nativeEvent)return!1;if(!this.sourceJoinPoint||!this.targetJoinPoint)return!1;const n=i.nativeEvent,s=new r(n.clientX,n.clientY),o=i.viewportToPixelCoordinate(s);if(this.lineElement.isPointIn(o))return!0;if(this.doubleArrow){if(this.targetArrowElement.isPointIn(o))return!0;if(this.sourceArrowElement.isPointIn(o))return!0}else if(this.arrow&&this.targetArrowElement.isPointIn(o))return!0;return!(!this.text||!this.textElement.isPointIn(o))}render(t){if(!(t=t||this.canvas&&this.canvas.graphCanvasCtx))return;const e=this.getSourceNode(),i=this.getTargetNode();if(e.visible||i.visible){const n=e.boundingJoinPoints,s=i.boundingJoinPoints;let o=0;if(this.sourceJoinPoint=void 0,this.targetJoinPoint=void 0,n.forEach(t=>{s.forEach(e=>{const i=t.distance(e);(o>i||!this.sourceJoinPoint||!this.targetJoinPoint)&&(o=i,this.sourceJoinPoint=t,this.targetJoinPoint=e)})}),!this.sourceJoinPoint||!this.targetJoinPoint)return;const a=this.sourceJoinPoint,h=this.targetJoinPoint;tt.copy(a);const c=tt.substract(e.centerPoint).normalize();et.copy(i.centerPoint);const d=et.substract(h).normalize();if(1===c.x||-1===c.x)if(1===d.x||-1===d.x){const t=(a.x+h.x)/2;this.middlePoints=[new r(t,a.y),new r(t,h.y)]}else this.middlePoints=[new r(h.x,a.y)];else if(1===d.x||-1===d.x)this.middlePoints=[new r(a.x,h.y)];else{const t=(a.y+h.y)/2;this.middlePoints=[new r(a.x,t),new r(h.x,t)]}t.save(),t.strokeStyle=this.active?this.style.activeColor:this.style.color,t.fillStyle=this.active?this.style.activeColor:this.style.color,this.dash&&t.setLineDash([4,4]),this.lineElement.lineWidth=this.style.lineWidth,this.lineElement.points=[a,...this.middlePoints,h],this.lineElement.render(t),this.text&&(this.centerPoint=S.getLinePoint([a,...this.middlePoints,h],.5),this.centerPoint&&(this.textElement.text=this.text,this.textElement.font="14px sans-serif",this.textElement.backgroundColor="rgba(255,255,255,0.8)",this.textElement.position.copy(this.centerPoint),this.textElement.render(t))),this.doubleArrow?(this.arrowStart=h,this.targetArrowElement.position.copy(h),this.targetArrowElement.rotate=d.xAxisAngle(),this.targetArrowElement.render(t),this.sourceArrowElement.position.copy(a),this.sourceArrowElement.rotate=c.xAxisAngle()+Math.PI,this.sourceArrowElement.render(t)):this.arrow&&(this.arrowStart=h,this.targetArrowElement.position.copy(h),this.targetArrowElement.rotate=d.xAxisAngle(),this.targetArrowElement.render(t)),this.animate.path=[a,...this.middlePoints,h],this.animate.update(),this.animate.render(t),t.restore()}}drawThumbnail(t){this.render(t)}}var st=nt;class ot extends f{constructor(t){super(),s()(this,"targetNode",void 0),s()(this,"sourceNode",void 0),s()(this,"edge",void 0),s()(this,"doubleArrow",!1),s()(this,"arrow",!1),s()(this,"dash",!1),s()(this,"text",""),s()(this,"onMouseUp",t=>{this.edge?(t.rootNode.getDescendantDF(t=>{if(t.isPointIn())return this.targetNode=t,!0}),this.targetNode&&this.sourceNode&&this.targetNode!==this.sourceNode&&!this.targetNode.hasDescendant(this.sourceNode)&&!this.sourceNode.hasDescendant(this.targetNode)?(this.edge.targetNode=this.targetNode,this.targetNode.addEdge(this.edge),t.virtualNode.removeEdge(this.edge),this.targetNode.isUpdate=!0,this.edge=void 0,this.targetNode=void 0,this.sourceNode=void 0):(t.removeEdge(this.edge),this.edge=void 0,this.targetNode=void 0,this.sourceNode=void 0)):(t.rootNode.getDescendantDF(t=>{if(t.isPointIn())return this.sourceNode=t,!0}),this.sourceNode&&(this.edge=new st({sourceNode:this.sourceNode,targetNode:t.virtualNode,dash:this.dash,arrow:this.arrow,text:this.text,doubleArrow:this.doubleArrow}),t.addEdge(this.edge))),t.repaint=!0}),s()(this,"onMouseMove",t=>{t.virtualNode.position=t.viewportToPixelCoordinate(t.mousemovePosition),this.sourceNode&&(t.virtualNode.isUpdate=!0),t.repaint=!0}),s()(this,"onUninstall",t=>{this.edge&&(t.removeEdge(this.edge),this.edge=void 0,this.targetNode=void 0,this.sourceNode=void 0),t.repaint=!0}),t&&(this.doubleArrow=t.doubleArrow||!1,this.arrow=t.arrow||!1,this.dash=t.dash||!1,this.text=t.text||"")}handleEvent(t,e){switch(e.type){case"mouseup":this.onMouseUp(t);break;case"mousemove":this.onMouseMove(t)}}}const rt=new ot;var at=ot;class ht extends f{constructor(...t){super(...t),s()(this,"onMouseDown",t=>{let e,i;const n=Math.random();t.rootNode.getDescendantDF(s=>{e||i||!s.visible?s.active=!1:(s.active=s.isPointIn(),s.active&&(e=s,t.setNodeTop(s))),s.isUpdate=!0,s.edges.forEach(t=>{t.renderSign!==n&&(t.renderSign=n,t.active=!1,i||e||(t.sourceNode.visible||t.targetNode.visible)&&(t.active=t.isPointIn(),t.active&&(i=t)))})}),t.repaint=!0})}handleEvent(t,e){switch(e.type){case"mousedown":this.onMouseDown(t)}}}const ct=new ht;var dt=ht;class ut extends f{constructor(...t){super(...t),s()(this,"minDragDistance",5),s()(this,"mouseDown",!1),s()(this,"activeNodes",[]),s()(this,"dragMove",!1),s()(this,"lastCoordinate",new a),s()(this,"onInstall",t=>{t.topCanvasMount()}),s()(this,"onUninstall",t=>{t.topCanvasCtx.clearRect(0,0,t.viewWidth,t.viewHeight),t.topCanvasUnmount()}),s()(this,"onMouseDown",(t,e)=>{this.dragMove=!1,this.lastCoordinate.copy(t.mousedownPosition);const i=t.getActiveNodes();i.length&&i.find(t=>t.visible&&t.isPointIn())?(this.dragMove=!0,this.activeNodes=i):(this.activeNodes=[],t.rootNode.getDescendantDF(t=>{t.isUpdate=!0,!this.activeNodes.length&&t.visible&&t.isPointIn()?(this.activeNodes.push(t),this.dragMove=!0,t.active=!0):t.active=!1}),t.repaint=!0),this.mouseDown=!0,t.topCanvasCtx.fillStyle="rgba(41, 193, 248, 0.3)",t.topCanvasCtx.strokeStyle="rgb(41, 193, 248)"}),s()(this,"onMouseMove",(t,e)=>{if(this.mouseDown)if(this.dragMove){const e=a.copy(t.mousemovePosition).substract(this.lastCoordinate);this.lastCoordinate.copy(t.mousemovePosition);const i=e.scale(1/t.canvasScale);this.activeNodes.forEach(t=>{t.translate(i)}),t.repaint=!0}else{const{mousedownPosition:e,mousemovePosition:i,topCanvasCtx:n,viewWidth:s,viewHeight:o}=t;if(a.copy(i).substract(e).magnitude<this.minDragDistance)return;const r=t.viewportToCanvasCoordinate(e),h=t.viewportToCanvasCoordinate(i),c=new a(r.x,h.y),d=new a(h.x,r.y);let u,l,v,p;n.clearRect(0,0,s,o),n.beginPath(),n.moveTo(r.x,r.y),n.lineTo(c.x,c.y),n.lineTo(h.x,h.y),n.lineTo(d.x,d.y),n.closePath(),n.fill(),n.stroke(),e.x>i.x?e.y>i.y?(u=t.viewportToPixelCoordinate(i),v=t.viewportToPixelCoordinate(e),l=new a(v.x,u.y),p=new a(u.x,v.y)):(l=t.viewportToPixelCoordinate(e),p=t.viewportToPixelCoordinate(i),u=new a(p.x,l.y),v=new a(l.x,p.y)):e.y>i.y?(l=t.viewportToPixelCoordinate(i),p=t.viewportToPixelCoordinate(e),u=new a(p.x,l.y),v=new a(l.x,p.y)):(u=t.viewportToPixelCoordinate(e),v=t.viewportToPixelCoordinate(i),l=new a(v.x,u.y),p=new a(u.x,v.y));const g=[u,l,v,p];t.rootNode.getDescendantBF(t=>{const e=t.active;t.hasActiveAncestor()?t.active=!1:t.isWrappedInRect(g)?t.active=!0:t.active=!1,e!==t.active&&(t.isUpdate=!0)}),t.repaint=!0}}),s()(this,"onMouseUp",(t,e)=>{if(!this.mouseDown)return;this.dragMove=!1;const{topCanvasCtx:i,viewWidth:n,viewHeight:s}=t;this.mouseDown=!1,i.clearRect(0,0,n,s)})}handleEvent(t,e){switch(e.type){case"mousedown":this.onMouseDown(t,e);break;case"mousemove":this.onMouseMove(t,e);break;case"mouseup":this.onMouseUp(t,e)}}}const lt=new ut;var vt=ut;var pt=class extends l{constructor(t){super(t),s()(this,"shapeType","rect"),s()(this,"width",void 0),s()(this,"height",void 0),s()(this,"minWidth",void 0),s()(this,"minHeight",void 0),s()(this,"collapseWidth",50),s()(this,"collapseHeight",50),this.width=t.width||100,this.height=t.height||100,this.minWidth=t.minWidth||30,this.minHeight=t.minHeight||30}get vertexes(){return this.getBoundingRect()}get boundingRect(){return this.getBoundingRect()}get boundingJoinPoints(){return this.getBoundingJoinPoints()}get centerPoint(){return this.getCenterPoint()}getPosition(){if(this.isExpanded)return this.position;{const{x:t,y:e}=this.position;return new a(t+(this.width-this.collapseWidth)/2,e+(this.height-this.collapseHeight)/2)}}getWidth(){return this.isExpanded?this.width:this.collapseWidth}getHeight(){return this.isExpanded?this.height:this.collapseHeight}isPointIn(){const{canvas:t}=this;if(!t)return!1;if(!this.visible)return!1;if(!t.nativeEvent)return!1;const e=t.nativeEvent,i=t.viewportToPixelCoordinate(new a(e.clientX,e.clientY));return S.isPointInRect(i,this.getPosition(),this.getWidth(),this.getHeight())}get joinPoint(){const{x:t,y:e}=this.getPosition();return new a(t+this.getWidth()/2,e+this.getHeight()/2)}getBoundingRect(){const t=this.getWidth(),e=this.getHeight(),{x:i,y:n}=this.getPosition();return[new a(i,n),new a(i+t,n),new a(i+t,n+e),new a(i,n+e)]}getBoundingJoinPoints(){const t=this.getWidth(),e=this.getHeight(),{x:i,y:n}=this.getPosition();return[new a(i+t/2,n),new a(i+t,n+e/2),new a(i+t/2,n+e),new a(i,n+e/2)]}getCenterPoint(){const t=this.getWidth(),e=this.getHeight(),{x:i,y:n}=this.getPosition();return new a(i+t/2,n+e/2)}isInRect(t){const e=this.getBoundingRect();return!(t[0].x>e[2].x||t[2].x<e[0].x||t[0].y>e[2].y||t[2].y<e[0].y)}isWrappedInRect(t){const e=this.getBoundingRect();return t[0].x<=e[0].x&&t[0].y<=e[0].y&&t[2].x>=e[2].x&&t[2].y>=e[2].y}drawThumbnail(t){const{x:e,y:i}=this.getPosition(),n=this.getWidth(),s=this.getHeight();t.save(),t.beginPath(),t.rect(e,i,n,s),t.fillStyle=this.active?this.style.activeColor:this.style.color,t.fill(),t.restore()}};class gt extends pt{constructor(t){super(t),s()(this,"renderType","CANVAS"),s()(this,"cacheCanvas",document.createElement("canvas"))}render(t){if(!this.canvas)return;const e=this.getWidth(),i=this.getHeight();t=t||this.cacheCanvas.getContext("2d"),this.cacheCanvas.width=e+4,this.cacheCanvas.height=i+4,t.rect(2,2,e,i),t.strokeStyle="#29c1f8",t.fillStyle="#fff",t.lineWidth=1,t.fill(),t.stroke(),t.textBaseline="middle",t.textAlign="center",t.font="14px serif",t.fillStyle="#29c1f8",t.fillText(this.text,e/2+2,i/2+2),this.canvas.repaint=!0}update(t){if(!this.canvas)return;const{graphCanvasCtx:e}=this.canvas,{x:i,y:n}=this.getPosition();e.save(),this.active&&(e.shadowBlur=5,e.shadowColor="rgba(255,0,0,0.8)"),e.drawImage(this.cacheCanvas,i-2,n-2),e.restore()}}class ft extends gt{constructor(t){super(t),s()(this,"isGroup",!0),s()(this,"canResize",!0),"boolean"==typeof t.isExpanded&&(this.isExpanded=t.isExpanded)}render(t){}update(t){if(!(t=t||this.canvas&&this.canvas.graphCanvasCtx))return;const e=this.getWidth(),i=this.getHeight(),{x:n,y:s}=this.getPosition(),o=this.centerPoint;t.beginPath(),t.rect(n,s,e,i),this.isExpanded||(t.moveTo(o.x,o.y-10),t.lineTo(o.x,o.y+10),t.moveTo(o.x-10,o.y),t.lineTo(o.x+10,o.y)),t.save(),this.active&&(t.shadowBlur=5,t.shadowColor=this.active?this.style.activeColor:this.style.color),t.strokeStyle=this.active?this.style.activeColor:this.style.color,t.stroke(),t.restore()}drawThumbnail(t){const{x:e,y:i}=this.getPosition(),n=this.getWidth(),s=this.getHeight();t.save(),t.beginPath(),t.rect(e,i,n,s),t.strokeStyle=this.active?this.style.activeColor:this.style.color,t.lineWidth=3,t.stroke(),t.restore()}}s()(ft,"shape","rect");var mt=ft;var wt=class{constructor(){s()(this,"canvas",null),s()(this,"enable",!0)}update(){}handleEvent(t){}},xt=i(4),yt=i.n(xt);class bt extends wt{constructor(){super(),s()(this,"position",new a),s()(this,"mounted",!1),s()(this,"container",document.createElement("div")),s()(this,"onContextMenu",null),s()(this,"menu",[]),s()(this,"hide",()=>{this.container.parentElement&&this.container.parentElement.removeChild(this.container)}),s()(this,"handleContextMenu",t=>{if(!this.canvas||!this.onContextMenu)return;this.position.x=t.clientX,this.position.y=t.clientY;const e=this.canvas.getActiveNodes(),i=this.canvas.getActiveEdges();let n=e.find(t=>t.isPointIn())||i.find(t=>t.isPointIn())||null;const s=this.onContextMenu(this,n,e,i);this.show(s)}),s()(this,"handleClick",t=>{if(!this.canvas)return;t.stopPropagation();const e=t.target;if(!e)return;if(e===this.container)return;const i=e.dataset.command,n=this.menu.find(t=>t.command===i);this.canvas.eventEmitter.emit("canvas:menu",n),this.hide()}),this.container.className=yt.a.menu}handleEvent(t){"contextmenu"===t.type&&this.handleContextMenu(t)}install(t){this.canvas=t,this.container.addEventListener("click",this.handleClick),document.addEventListener("click",this.hide)}destroy(){this.canvas&&(this.container.removeEventListener("click",this.handleClick),document.removeEventListener("click",this.hide),this.canvas=null)}show(t=[],e,i){if(this.hide(),!t.length)return;this.menu=t;let{x:n,y:s}=this.position;n=void 0!==e?e:n,s=void 0!==i?i:s;const o=this.menu.map(t=>`<div class="item" data-command="${t.command}">${t.label}</div>`);this.container.innerHTML=o.join(""),Object.assign(this.container.style,{left:`${n}px`,top:`${s}px`}),document.body.appendChild(this.container)}}var Et=bt;class Ct extends f{constructor(t){super(),s()(this,"canvas",void 0),s()(this,"parentNode",void 0),s()(this,"ctor",mt),s()(this,"onContextMenu",(t,e)=>{const i=t.plugins.find(t=>t instanceof Et);if(!i)return;const n=t.getActiveNodes(),s=e;if(n.length){this.parentNode=void 0,-1===n.findIndex(t=>!!t.parent&&(!(!this.parentNode||this.parentNode===t.parent)||(this.parentNode=t.parent,!1)))&&i.show([{label:"添加到组",command:"addToGroup"}],s.clientX,s.clientY)}}),s()(this,"onInstall",t=>{this.canvas=t,t.eventEmitter.on("canvas:menu",this.onAddToGroup)}),s()(this,"onUninstall",t=>{t.eventEmitter.off("canvas:menu",this.onAddToGroup)}),s()(this,"onAddToGroup",t=>{if("addToGroup"!==t.command)return;const e=this.canvas.getActiveNodes();if(!e.length)return;const i=new this.ctor({id:Math.random()});let n=Number.MAX_SAFE_INTEGER,s=Number.MAX_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER;e.forEach(t=>{t.boundingRect.forEach(t=>{t.x<n&&(n=t.x),t.x>o&&(o=t.x),t.y<s&&(s=t.y),t.y>r&&(r=t.y)}),i.addChild(t)}),(this.ctor.shape="rect")&&(i.width=o-n+40,i.height=r-s+40),i.position.x=n-20,i.position.y=s-20,this.parentNode?(this.parentNode.addChild(i),this.canvas.repaint=!0):this.canvas.addNode(i)}),t&&(this.ctor=t.ctor)}handleEvent(t,e){switch(e.type){case"contextmenu":this.onContextMenu(t,e)}}}const Pt=new Ct;var Nt=Ct;const Mt=new a(-3,-3);class At extends f{constructor(...t){super(...t),s()(this,"activeNode",void 0),s()(this,"flag",!1),s()(this,"activeAnchorIndex",-1),s()(this,"onInstall",t=>{t.topCanvasMount()}),s()(this,"onUninstall",t=>{t.topCanvasCtx.clearRect(0,0,t.viewWidth,t.viewHeight),t.topCanvasUnmount()}),s()(this,"onMouseUp",t=>{this.activeAnchorIndex=-1,w.onMouseUp(t)}),s()(this,"onMouseDown",t=>{if(this.activeAnchorIndex=this.getActiveAnchorIndex(t),-1===this.activeAnchorIndex){ct.onMouseDown(t),w.onMouseDown(t);const e=t.getActiveNodes()[0];e&&e.canResize&&e.isExpanded?this.activeNode=e:this.activeNode=void 0}}),s()(this,"onMouseMove",(t,e)=>{const i=this.activeNode;if(this.activeAnchorIndex>-1&&i){const n=e,s=t.viewportToPixelCoordinate(new a(n.clientX,n.clientY));i.isUpdate=!0,t.repaint=!0,"rect"===i.shapeType?function(t,e,i){const n=t.boundingRect;let s=t.getWidth(),o=t.getHeight();switch(e){case 0:s=n[2].x-i.x,o=n[2].y-i.y,s>=t.minWidth&&(t.position.x=i.x,t.width=s),o>=t.minHeight&&(t.position.y=i.y,t.height=o);break;case 1:s=i.x-n[3].x,o=n[3].y-i.y,s>=t.minWidth&&(t.width=s),o>=t.minHeight&&(t.position.y=i.y,t.height=o);break;case 2:s=i.x-n[0].x,o=i.y-n[0].y,s>=t.minWidth&&(t.width=s),o>=t.minHeight&&(t.height=o);break;case 3:s=n[1].x-i.x,o=i.y-n[1].y,s>=t.minWidth&&(t.position.x=i.x,t.width=s),o>=t.minHeight&&(t.height=o);break;case 4:(o=n[2].y-i.y)>=t.minHeight&&(t.position.y=i.y,t.height=o);break;case 5:(s=i.x-n[0].x)>=t.minWidth&&(t.width=s);break;case 6:(o=i.y-n[0].y)>=t.minHeight&&(t.height=o);break;case 7:(s=n[2].x-i.x)>=t.minWidth&&(t.position.x=i.x,t.width=s)}}(i,this.activeAnchorIndex,s):function(t,e,i){let n=t.radius,s=t.minRadius;const o=t.centerPoint;switch(e){case 0:case 1:case 2:case 3:n=a.copy(i).substract(o).magnitude/Math.sqrt(2);break;case 4:case 5:case 6:case 7:n=a.copy(i).substract(o).magnitude}n>=s&&(t.radius=n,t.position.y=o.y-n,t.position.x=o.x-n)}(i,this.activeAnchorIndex,s),i.render()}else{const e=this.getActiveAnchorIndex(t);let i="default";if(e>-1)switch(e){case 0:i="nwse-resize";break;case 1:i="nesw-resize";break;case 2:i="nwse-resize";break;case 3:i="nesw-resize";break;case 4:i="ns-resize";break;case 5:i="ew-resize";break;case 6:i="ns-resize";break;case 7:i="ew-resize"}else w.onMouseMove(t);t.wrapper.style.cursor=i}}),s()(this,"onUpdate",t=>{if(t.topCanvasCtx.clearRect(0,0,t.viewWidth,t.viewHeight),this.activeNode){const e=[...this.activeNode.boundingRect,...this.activeNode.boundingJoinPoints];t.topCanvasCtx.save(),t.topCanvasCtx.fillStyle="#2D8CF5",t.topCanvasCtx.beginPath(),e.forEach(e=>{const i=t.pixelToCanvasCoordinate(e);t.topCanvasCtx.rect(i.x-3,i.y-3,6,6),t.topCanvasCtx.fill()}),t.topCanvasCtx.restore()}})}getActiveAnchorIndex(t){if(!this.activeNode)return-1;const e=[...this.activeNode.boundingRect,...this.activeNode.boundingJoinPoints];let i=0;return e.find((e,n)=>{const s=t.pixelToViewportCoordinate(e).add(Mt);return i=n,S.isPointInRect(t.mousemovePosition,s,6,6)})?i:-1}handleEvent(t,e){switch(e.type){case"mousedown":this.onMouseDown(t);break;case"mousemove":this.onMouseMove(t,e);break;case"mouseup":this.onMouseUp(t)}}}new At;var It=At;class _t extends f{constructor(...t){super(...t),s()(this,"lastTimestamp",0),s()(this,"onMouseDown",t=>{const e=Date.now();if(e-this.lastTimestamp<300){const e=t.getActiveNodes()[0];e&&e.isGroup&&(e.isExpanded=!e.isExpanded,e.isUpdate=!0,e.render(),t.repaint=!0)}this.lastTimestamp=e})}handleEvent(t,e){switch(e.type){case"mousedown":this.onMouseDown(t)}}}new _t;var Tt=_t;const St="mode.default";const Rt=new class{constructor(){s()(this,"modes",{})}registerMode(t,e){this.modes[t]=e}unregisterMode(t){delete this.modes[t]}use(t){return this.modes[t]||[]}hasMode(t){return this.modes.hasOwnProperty(t)}};Rt.registerMode(St,[new dt,new x,new E,new I,new Tt]),Rt.registerMode("mode.view",[new N,new I]),Rt.registerMode("mode.create.edge",[new dt,new I,new Q({arrow:!0}),new N]),Rt.registerMode("mode.create.L",[new dt,new I,new at({arrow:!0}),new N]),Rt.registerMode("mode.area.pick",[new I,new vt,new Nt]),Rt.registerMode("mode.border",[new It,new I]);var Dt=Rt,kt=i(5),Ot=i.n(kt);const Wt=["click","dblclick","mousedown","wheel","dragover","drop","contextmenu","mouseenter"];class Lt{static registerMode(t,e){Dt.registerMode(t,e)}constructor(t){s()(this,"mounted",!1),s()(this,"_running",!1),s()(this,"_animationFrameId",0),s()(this,"name","application"),s()(this,"eventEmitter",new o),s()(this,"nativeEvent",null),s()(this,"optimize",!0),s()(this,"interactionMode",St),s()(this,"container",void 0),s()(this,"wrapper",document.createElement("div")),s()(this,"containerClientRect",void 0),s()(this,"graphCanvas",document.createElement("canvas")),s()(this,"graphCanvasCtx",void 0),s()(this,"domCanvas",document.createElement("div")),s()(this,"topCanvas",document.createElement("canvas")),s()(this,"topCanvasMounted",!1),s()(this,"topCanvasCtx",void 0),s()(this,"virtualNode",new v({})),s()(this,"mousedownPosition",new a),s()(this,"mouseupPosition",new a),s()(this,"mousemovePosition",new a),s()(this,"ro",void 0),s()(this,"viewWidth",0),s()(this,"viewHeight",0),s()(this,"canvasWidth",0),s()(this,"canvasHeight",0),s()(this,"canvasScale",void 0),s()(this,"maxScale",void 0),s()(this,"minScale",void 0),s()(this,"repaint",!1),s()(this,"animate",!1),s()(this,"rootNode",new v({})),s()(this,"plugins",[]),s()(this,"handleNativeEvent",t=>{switch(this.nativeEvent=t,t.type){case"mousedown":{const{clientX:e,clientY:i}=t;this.mousedownPosition.x=e,this.mousedownPosition.y=i,this.getBoundingClientRect();break}case"mousemove":{const{clientY:e,clientX:i}=t;this.mousemovePosition.x=i,this.mousemovePosition.y=e,this.optimizeNode();break}case"mouseup":{const{clientX:e,clientY:i}=t;this.mouseupPosition.x=e,this.mouseupPosition.y=i;break}case"mouseenter":case"drop":this.getBoundingClientRect();break;case"contextmenu":t.preventDefault()}this.plugins.forEach(e=>{e.handleEvent(t)}),Dt.use(this.interactionMode).forEach(e=>{e.handleEvent(this,t)}),this.eventEmitter.emit(t.type,t)}),this.container=t.container,this.wrapper.className=Ot.a.topology,this.graphCanvasCtx=this.graphCanvas.getContext("2d"),this.topCanvasCtx=this.topCanvas.getContext("2d"),this.canvasScale=t.scale||1,this.maxScale=t.maxScale||5,this.minScale=t.minScale||.1,this.animate=t.animate||!1,this.rootNode.canvas=this,this.virtualNode.maxDepth=!0,this.ro=new h.a((t,e)=>{for(const e of t){const{width:t,height:i}=e.contentRect;this.viewWidth=t,this.viewHeight=i,this.canvasWidth=t/this.canvasScale,this.canvasHeight=i/this.canvasScale,this.getBoundingClientRect()}this.mount(),this.render(),this.optimizeNode(),this.repaint=!0}),this.ro.observe(this.container),this.nativeEventInit(),this.setMode(t.mode||St)}setZoom(t){this.canvasScale=t,this.canvasWidth=this.viewWidth/this.canvasScale,this.canvasHeight=this.viewHeight/this.canvasScale,this.render(),this.optimizeNode(),this.repaint=!0}nativeEventInit(){Wt.forEach(t=>{this.wrapper.addEventListener(t,this.handleNativeEvent)}),document.addEventListener("mousemove",this.handleNativeEvent),document.addEventListener("mouseup",this.handleNativeEvent)}destroy(){for(Wt.forEach(t=>{this.wrapper.removeEventListener(t,this.handleNativeEvent)}),document.removeEventListener("mousemove",this.handleNativeEvent),document.removeEventListener("mouseup",this.handleNativeEvent),this.ro.unobserve(this.container),this.ro.disconnect(),this.eventEmitter.clear(),this.unmount(),this.removeAllNode();this.plugins.length;){const t=this.plugins.pop();t&&t.destroy()}}addNode(t){this.rootNode.hasChild(t)||(t.visible=t.isInRect(this.canvasVisibleRect),this.rootNode.addChild(t),this.repaint=!0)}setNodeTop(t){const e=t.parent;if(!e)return;const i=e.lastChild&&e.lastChild.zIndex||0;t.zIndex=Math.max(i,t.zIndex),e.removeChild(t,!1),e.addChild(t),t.unmount(),t.mount(),this.repaint=!0}getActiveNodes(){return this.rootNode.getActiveDescendant()}removeNode(t,e=!0){if(!this.rootNode.hasDescendant(t))return;if(!t.parent)return;t.parent.removeChild(t,e),[...t.edges].forEach(t=>{this.removeEdge(t)}),this.repaint=!0}removeAllNode(t=!0){this.rootNode.removeAllChild(t)}addEdge(t){t.sourceNode.addEdge(t),t.targetNode.addEdge(t),t.canvas=this,this.repaint=!0}removeEdge(t){t.sourceNode.removeEdge(t),t.targetNode.removeEdge(t),t.canvas=void 0,this.repaint=!0}getActiveEdges(){const t=[],e=Math.random();return this.rootNode.getDescendantBF(i=>{i.edges.forEach(i=>{i.renderSign!==e&&(i.renderSign=e,i.active&&t.push(i))})}),t}getBoundingClientRect(){return this.containerClientRect=this.container.getBoundingClientRect(),this.containerClientRect}getContentBoundingRect(){const t=new a(0,0),e=new a(this.canvasWidth,this.canvasHeight);return this.rootNode.getDescendantBF(i=>{const n=i.boundingRect;n[0].x<t.x&&(t.x=n[0].x),n[0].y<t.y&&(t.y=n[0].y),n[2].x>e.x&&(e.x=n[2].x),n[2].y>e.y&&(e.y=n[2].y)}),[t,new a(e.x,t.y),e,new a(t.x,e.y)]}viewportToCanvasCoordinate(t){const{top:e,left:i}=this.containerClientRect||this.getBoundingClientRect();return t.clone().substract(new a(i,e))}canvasToViewportCoordinate(t){const{top:e,left:i}=this.containerClientRect||this.getBoundingClientRect();return t.clone().add(new a(i,e))}canvasToPixelCoordinate(t){return t.clone().scale(1/this.canvasScale)}pixelToCanvasCoordinate(t){return t.clone().scale(this.canvasScale)}viewportToPixelCoordinate(t){return this.canvasToPixelCoordinate(this.viewportToCanvasCoordinate(t))}pixelToViewportCoordinate(t){return this.canvasToViewportCoordinate(this.pixelToCanvasCoordinate(t))}get canvasVisibleRect(){return[new a(0,0),new a(this.canvasWidth,0),new a(this.canvasWidth,this.canvasHeight),new a(0,this.canvasHeight)]}zoomIn(t){t=t?this.viewportToCanvasCoordinate(t):new a(this.viewWidth/2,this.viewHeight/2);const e=this.canvasToPixelCoordinate(t);this.canvasScale+=.15,this.canvasScale=this.canvasScale>this.maxScale?this.maxScale:this.canvasScale;const i=this.canvasToPixelCoordinate(t).substract(e);this.canvasWidth=this.viewWidth/this.canvasScale,this.canvasHeight=this.viewHeight/this.canvasScale,this.rootNode.children.forEach(t=>{t.translate(i)}),this.optimizeNode(),this.render(),this.repaint=!0,this.eventEmitter.emit("canvas:zoom")}zoomOut(t){t=t?this.viewportToCanvasCoordinate(t):new a(this.viewWidth/2,this.viewHeight/2);const e=this.canvasToPixelCoordinate(t);this.canvasScale-=.15,this.canvasScale=this.canvasScale<this.minScale?this.minScale:this.canvasScale;const i=this.canvasToPixelCoordinate(t).substract(e);this.canvasWidth=this.viewWidth/this.canvasScale,this.canvasHeight=this.viewHeight/this.canvasScale,this.rootNode.children.forEach(t=>{t.translate(i)}),this.optimizeNode(),this.render(),this.repaint=!0,this.eventEmitter.emit("canvas:zoom")}setMode(t){if(!Dt.hasMode(t))return void console.warn(`该模式不存在:${t}`);let e=Dt.use(this.interactionMode);e.forEach(t=>{t.onUninstall(this)}),this.interactionMode=t,(e=Dt.use(this.interactionMode)).forEach(t=>{t.onInstall(this)})}optimizeNode(){if(!this.optimize)return;const t=this.canvasVisibleRect;this.rootNode.getDescendantBF().forEach(e=>{e.visible=e.isInRect(t)})}use(t){t.install(this),this.plugins.push(t)}render(){Object.assign(this.domCanvas.style,{width:`${this.canvasWidth}px`,height:`${this.canvasHeight}px`,left:`${(this.viewWidth-this.canvasWidth)/2}px`,top:`${(this.viewHeight-this.canvasHeight)/2}px`,transform:`scale(${this.canvasScale})`}),this.graphCanvas.width=this.topCanvas.width=this.viewWidth,this.graphCanvas.height=this.topCanvas.height=this.viewHeight}mount(){this.mounted||(this.wrapper.appendChild(this.graphCanvas),this.wrapper.appendChild(this.domCanvas),this.container.appendChild(this.wrapper),this.eventEmitter.emit("canvas:mounted"),this.mounted=!0)}topCanvasMount(){this.topCanvasMounted||(this.wrapper.appendChild(this.topCanvas),this.topCanvasMounted=!0)}topCanvasUnmount(){this.topCanvasMounted&&(this.wrapper.removeChild(this.topCanvas),this.topCanvasMounted=!1)}unmount(){this.mounted&&(this.container.removeChild(this.wrapper),this.mounted=!1)}start(){this._running||(this._running=!0,this.loop())}stop(){this._running&&(cancelAnimationFrame(this._animationFrameId),this._running=!1)}loop(){this._running&&(this._animationFrameId=requestAnimationFrame(()=>{if(G.update(),this.repaint||this.animate){this.graphCanvasCtx.clearRect(0,0,this.viewWidth,this.viewHeight),this.graphCanvasCtx.save(),this.graphCanvasCtx.scale(this.canvasScale,this.canvasScale),this.renderNodes(),this.graphCanvasCtx.restore(),Dt.use(this.interactionMode).forEach(t=>{t.onUpdate(this)}),this.plugins.forEach(t=>{t.enable&&t.update()}),this.repaint=!1}this.loop()}))}renderNodes(){this.rootNode.getDescendantBF(t=>{const e=t.visible;t.edges.forEach(e=>{e.renderSign!==this._animationFrameId&&(e.sourceNode===t?e.targetNode.depth<=t.depth&&(e.render(),e.renderSign=this._animationFrameId):e.sourceNode.depth<=t.depth&&(e.render(),e.renderSign=this._animationFrameId))}),"CANVAS"===t.renderType&&e&&t.update(),"DOM"===t.renderType&&(e?(t.mount(),t.isUpdate&&(t.update(),t.isUpdate=!1)):t.unmount())}),this.virtualNode.edges.forEach(t=>{t.render()})}}s()(Lt,"config",{createLineOptions:{arrow:!0,text:""}});class Ht extends f{}const Ut=new Ht;class Bt extends pt{constructor(t){super(t),s()(this,"renderType","DOM"),s()(this,"$el",document.createElement("div")),Object.assign(this.$el.style,{position:"absolute",left:0,top:0})}mount(){!this.mounted&&this.canvas&&(this.mounted=!0,this.canvas.domCanvas.appendChild(this.$el))}unmount(){this.mounted&&this.canvas&&(this.mounted=!1,this.canvas.domCanvas.removeChild(this.$el))}render(t){this.$el.innerHTML=`<div style="height:100%;\n                                      display:flex;\n                                      align-items:center;\n                                      justify-content:center;\n                                      border:1px solid #29c1f8;\n                                      box-sizing: border-box;\n                                      font-size:12px;\n                                      user-select: none;\n                                      color:#29c1f8;">${this.text}</div>`}update(t){const{x:e,y:i}=this.getPosition(),n=this.getWidth(),s=this.getHeight(),{active:o}=this;Object.assign(this.$el.style,{transform:`translate3d(${e}px,${i}px,0)`,width:`${n}px`,height:`${s}px`,boxShadow:o?"0 0 5px 0 rgba(255,0,0,0.8)":"none"})}}var zt=Bt;var jt=class extends l{get boundingJoinPoints(){return this.getBoundingJoinPoints()}get boundingRect(){return this.getBoundingRect()}get centerPoint(){return this.getCenterPoint()}get vertexes(){return this.getBoundingRect()}constructor(t){super(t),s()(this,"shapeType","circle"),s()(this,"radius",void 0),s()(this,"minRadius",void 0),s()(this,"text",void 0),this.radius=t.radius||50,this.minRadius=t.minRadius||30,this.text=t.text||""}isPointIn(){const{canvas:t,centerPoint:e,radius:i}=this;if(!t)return!1;if(!this.visible)return!1;if(!t.nativeEvent)return!1;const n=t.nativeEvent,s=t.viewportToPixelCoordinate(new a(n.clientX,n.clientY));return S.isPointInCircle(s,e,i)}getBoundingRect(){const{radius:t,position:{x:e,y:i}}=this,n=2*t;return[new a(e,i),new a(e+n,i),new a(e+n,i+n),new a(e,i+n)]}getBoundingJoinPoints(){const{radius:t,position:{x:e,y:i}}=this,n=2*t;return[new a(e+t,i),new a(e+n,i+t),new a(e+t,i+n),new a(e,i+t)]}getCenterPoint(){const{position:{x:t,y:e},radius:i}=this;return new a(t+i,e+i)}isInRect(t){const e=this.getBoundingRect();return!(t[0].x>e[2].x||t[2].x<e[0].x||t[0].y>e[2].y||t[2].y<e[0].y)}isWrappedInRect(t){const e=this.getBoundingRect();return t[0].x<=e[0].x&&t[0].y<=e[0].y&&t[2].x>=e[2].x&&t[2].y>=e[2].y}drawThumbnail(t){const{x:e,y:i}=this.centerPoint;t.save(),t.beginPath(),t.arc(e,i,this.radius,0,2*Math.PI),t.fillStyle=this.active?this.style.activeColor:this.style.color,t.fill(),t.restore()}};class Ft extends jt{constructor(t){super(t),s()(this,"renderType","CANVAS"),s()(this,"cacheCanvas",document.createElement("canvas"))}render(){const{radius:t,canvas:e,active:i}=this;if(!e)return;const n=2*t;this.cacheCanvas.width=n+2,this.cacheCanvas.height=n+2;const s=this.cacheCanvas.getContext("2d");s.beginPath(),s.arc(t+1,t+1,t,0,2*Math.PI),s.strokeStyle="#29c1f8",s.fillStyle="#fff",s.lineWidth=2,s.stroke(),s.fill(),this.text&&(s.textBaseline="middle",s.textAlign="center",s.font="14px serif",s.fillStyle="#29c1f8",s.fillText(this.text,t+1,t+1)),e.repaint=!0}update(){if(!this.canvas)return;const{graphCanvasCtx:t}=this.canvas,{x:e,y:i}=this.getPosition();t.save(),this.active&&(t.shadowBlur=5,t.shadowColor="rgba(255,0,0,0.8)"),t.drawImage(this.cacheCanvas,e-1,i-1),t.restore()}}var Gt=Ft;class Jt extends zt{constructor(t){super(t),s()(this,"isGroup",!0),s()(this,"canResize",!0),"boolean"==typeof t.isExpanded&&(this.isExpanded=t.isExpanded)}render(){this.$el.innerHTML=`<div style="height:100%;\n                                      display:flex;\n                                      align-items:center;\n                                      justify-content:center;\n                                      border:1px solid #066df2;\n                                      box-sizing:border-box;">\n                            ${this.isExpanded?"":"..."}\n                          </div>`}drawThumbnail(t){const{x:e,y:i}=this.getPosition(),n=this.getWidth(),s=this.getHeight();t.save(),t.beginPath(),t.rect(e,i,n,s),t.strokeStyle=this.active?this.style.activeColor:this.style.color,t.lineWidth=3,t.stroke(),t.restore()}}class $t extends Gt{constructor(t){super(t),s()(this,"isGroup",!0),s()(this,"canResize",!0),"boolean"==typeof t.isExpanded&&(this.isExpanded=t.isExpanded)}render(t){}update(t){if(!(t=t||this.canvas&&this.canvas.graphCanvasCtx))return;const{x:e,y:i}=this.getPosition();t.beginPath(),t.arc(e+this.radius,i+this.radius,this.radius,0,2*Math.PI),t.save(),this.active&&(t.shadowBlur=5,t.shadowColor=this.active?this.style.activeColor:this.style.color),t.strokeStyle=this.active?this.style.activeColor:this.style.color,t.stroke(),t.restore()}drawThumbnail(t){const{x:e,y:i}=this.centerPoint;t.save(),t.beginPath(),t.arc(e,i,this.radius,0,2*Math.PI),t.strokeStyle=this.active?this.style.activeColor:this.style.color,t.lineWidth=3,t.stroke(),t.restore()}}s()($t,"shape","circle");function Vt(t){let e=!1;return function(...i){e||(e=!0,t(...i),requestAnimationFrame(()=>{e=!1}))}}function Xt(t){return new Promise((e,i)=>{const n=new Image;n.src=t,n.onload=(()=>{e(n)}),n.onerror=(()=>{i()})})}function Yt(t,e){e.forEach(e=>{Object.getOwnPropertyNames(e.prototype).forEach(i=>{"constructor"!==i&&(t.prototype[i]=e.prototype[i])})})}class qt extends R{constructor(t){super(),s()(this,"image",void 0),"string"==typeof t?(async()=>{try{this.image=await Xt(t)}catch(t){console.error(t)}})():this.image=t}render(t){if(!this.image)return;const{width:e,height:i}=this.image,{x:n,y:s}=this.position,{x:o,y:r}=this.offset;t.save(),t.translate(n,s),t.rotate(this.rotate),t.translate(o,r),t.drawImage(this.image,-e/2,-i/2),t.restore()}isPointIn(t){if(!this.image)return!1;const{width:e,height:i}=this.image,n=new a(-e/2,-i/2).add(this.offset).rotate(this.rotate),s=new a(-e/2,+i/2).add(this.offset).rotate(this.rotate),o=new a(+e/2,+i/2).add(this.offset).rotate(this.rotate),r=new a(+e/2,-i/2).add(this.offset).rotate(this.rotate);return S.isPointInPolygon(a.copy(t).substract(this.position),[n,s,o,r])}}const Zt=new a,Kt=new a,Qt=new a;class te extends wt{get width(){return this.canvasElement.width}set width(t){this.canvasElement.width=t}get height(){return this.canvasElement.height}set height(t){this.canvasElement.height=t}constructor(t=200,e=200){super(),s()(this,"canvasElement",document.createElement("canvas")),s()(this,"handleMouseMove",Vt(t=>{if(1!==t.buttons||!this.canvas||0===Zt.magnitude)return Zt.x=t.offsetX,void(Zt.y=t.offsetY);Kt.x=t.offsetX,Kt.y=t.offsetY;const e=this.canvas.getContentBoundingRect(),i=e[2].x-e[0].x,n=e[2].y-e[0].y,s=Math.max(i/this.width,n/this.height);Qt.copy(Kt).substract(Zt).scale(-s),this.canvas.rootNode.translate(Qt),this.canvas.repaint=!0,Zt.copy(Kt)})),this.canvasElement.width=t,this.canvasElement.height=e,this.canvasElement.draggable=!1}install(t){this.canvas=t,this.canvasElement.addEventListener("mousemove",this.handleMouseMove)}destroy(){this.canvasElement.removeEventListener("mousemove",this.handleMouseMove),this.canvas=null}update(){this.render()}render(){if(!this.canvas)return;const t=this.canvas.getContentBoundingRect(),e=t[2].x-t[0].x,i=t[2].y-t[0].y,n=Math.min(this.width/e,this.height/i),s=this.canvasElement.getContext("2d"),o=(this.width/n-e)/2-t[0].x,r=(this.height/n-i)/2-t[0].y;s.clearRect(0,0,this.width,this.height),s.save(),s.scale(n,n),s.translate(o,r);const a=Math.random();this.canvas.rootNode.getDescendantBF(t=>{t.edges.forEach(e=>{e.renderSign!==a&&(e.sourceNode===t?e.targetNode.depth<=t.depth&&(e.drawThumbnail(s),e.renderSign=a):e.sourceNode.depth<=t.depth&&(e.drawThumbnail(s),e.renderSign=a))}),t.miniMapVisible&&t.drawThumbnail(s)}),s.translate(-o,-r),s.beginPath(),s.rect(0,0,this.width/n,this.height/n),s.rect(o,r,this.canvas.canvasWidth,this.canvas.canvasHeight),s.fillStyle="rgba(0,0,0,0.3)",s.fill("evenodd"),s.beginPath(),s.rect(o,r,this.canvas.canvasWidth,this.canvas.canvasHeight),s.strokeStyle="#29c1f8",s.lineWidth=1/n,s.stroke(),s.restore()}mount(t){t.appendChild(this.canvasElement)}unmount(){this.canvasElement.parentElement&&this.canvasElement.parentElement.removeChild(this.canvasElement)}}i.d(e,"Canvas",function(){return Lt}),i.d(e,"EventEmitter",function(){return o}),i.d(e,"Edge",function(){return _}),i.d(e,"Node",function(){return u}),i.d(e,"MODE_DEFAULT",function(){return St}),i.d(e,"MODE_VIEW",function(){return"mode.view"}),i.d(e,"MODE_CREATE_EDGE",function(){return"mode.create.edge"}),i.d(e,"MODE_CREATE_L",function(){return"mode.create.L"}),i.d(e,"MODE_AREA_PICK",function(){return"mode.area.pick"}),i.d(e,"MODE_BORDER",function(){return"mode.border"}),i.d(e,"Interaction",function(){return g}),i.d(e,"SelectInteraction",function(){return ht}),i.d(e,"selectInteraction",function(){return ct}),i.d(e,"CreateLineInteraction",function(){return Z}),i.d(e,"createEdgeInteraction",function(){return K}),i.d(e,"CreateLInteraction",function(){return ot}),i.d(e,"createLInteraction",function(){return rt}),i.d(e,"DragInteraction",function(){return m}),i.d(e,"dragInteraction",function(){return w}),i.d(e,"DropInteraction",function(){return y}),i.d(e,"dropInteraction",function(){return b}),i.d(e,"MenuInteraction",function(){return Ht}),i.d(e,"menuInteration",function(){return Ut}),i.d(e,"MoveCanvasInteraction",function(){return C}),i.d(e,"moveCanvasInteraction",function(){return P}),i.d(e,"WheelZoomInteraction",function(){return M}),i.d(e,"wheelZoomInteraction",function(){return A}),i.d(e,"AreaPickInteraction",function(){return ut}),i.d(e,"areaPickInteraction",function(){return lt}),i.d(e,"CreateGroupInteraction",function(){return Ct}),i.d(e,"createGroupInteraction",function(){return Pt}),i.d(e,"RectDomNode",function(){return Bt}),i.d(e,"RectCanvasNode",function(){return gt}),i.d(e,"CircleCanvasNode",function(){return Ft}),i.d(e,"RectGroup",function(){return ft}),i.d(e,"RectDomGroup",function(){return Jt}),i.d(e,"CircleGroup",function(){return $t}),i.d(e,"Line",function(){return V}),i.d(e,"L",function(){return nt}),i.d(e,"Math2d",function(){return T}),i.d(e,"Vector2d",function(){return r}),i.d(e,"throttle",function(){return Vt}),i.d(e,"imgLoad",function(){return Xt}),i.d(e,"applyMixins",function(){return Yt}),i.d(e,"Img",function(){return qt}),i.d(e,"Rect",function(){return O}),i.d(e,"Text",function(){return H}),i.d(e,"Triangle",function(){return D}),i.d(e,"Polyline",function(){return z}),i.d(e,"MiniMap",function(){return te}),i.d(e,"ContextMenu",function(){return bt})}])});