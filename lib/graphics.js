!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var i=e();for(var n in i)("object"==typeof exports?exports:t)[n]=i[n]}}(window,function(){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(n,s,function(e){return t[e]}.bind(null,s));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=10)}([function(t,e){t.exports=function(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}},function(t,e,i){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map(function(e){var i=function(t,e){var i=t[1]||"",n=t[3];if(!n)return i;if(e&&"function"==typeof btoa){var s=(r=n,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */"),o=n.sources.map(function(t){return"/*# sourceURL="+n.sourceRoot+t+" */"});return[i].concat(o).concat([s]).join("\n")}var r;return[i].join("\n")}(e,t);return e[2]?"@media "+e[2]+"{"+i+"}":i}).join("")},e.i=function(t,i){"string"==typeof t&&(t=[[null,t,""]]);for(var n={},s=0;s<this.length;s++){var o=this[s][0];null!=o&&(n[o]=!0)}for(s=0;s<t.length;s++){var r=t[s];null!=r[0]&&n[r[0]]||(i&&!r[2]?r[2]=i:i&&(r[2]="("+r[2]+") and ("+i+")"),e.push(r))}},e}},function(t,e,i){var n,s,o={},r=(n=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===s&&(s=n.apply(this,arguments)),s}),a=function(t){var e={};return function(t,i){if("function"==typeof t)return t();if(void 0===e[t]){var n=function(t,e){return e?e.querySelector(t):document.querySelector(t)}.call(this,t,i);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}}(),h=null,c=0,d=[],u=i(7);function l(t,e){for(var i=0;i<t.length;i++){var n=t[i],s=o[n.id];if(s){s.refs++;for(var r=0;r<s.parts.length;r++)s.parts[r](n.parts[r]);for(;r<n.parts.length;r++)s.parts.push(x(n.parts[r],e))}else{var a=[];for(r=0;r<n.parts.length;r++)a.push(x(n.parts[r],e));o[n.id]={id:n.id,refs:1,parts:a}}}}function v(t,e){for(var i=[],n={},s=0;s<t.length;s++){var o=t[s],r=e.base?o[0]+e.base:o[0],a={css:o[1],media:o[2],sourceMap:o[3]};n[r]?n[r].parts.push(a):i.push(n[r]={id:r,parts:[a]})}return i}function p(t,e){var i=a(t.insertInto);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var n=d[d.length-1];if("top"===t.insertAt)n?n.nextSibling?i.insertBefore(e,n.nextSibling):i.appendChild(e):i.insertBefore(e,i.firstChild),d.push(e);else if("bottom"===t.insertAt)i.appendChild(e);else{if("object"!=typeof t.insertAt||!t.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var s=a(t.insertAt.before,i);i.insertBefore(e,s)}}function g(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t);var e=d.indexOf(t);e>=0&&d.splice(e,1)}function f(t){var e=document.createElement("style");if(void 0===t.attrs.type&&(t.attrs.type="text/css"),void 0===t.attrs.nonce){var n=function(){0;return i.nc}();n&&(t.attrs.nonce=n)}return m(e,t.attrs),p(t,e),e}function m(t,e){Object.keys(e).forEach(function(i){t.setAttribute(i,e[i])})}function x(t,e){var i,n,s,o;if(e.transform&&t.css){if(!(o="function"==typeof e.transform?e.transform(t.css):e.transform.default(t.css)))return function(){};t.css=o}if(e.singleton){var r=c++;i=h||(h=f(e)),n=b.bind(null,i,r,!1),s=b.bind(null,i,r,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(i=function(t){var e=document.createElement("link");return void 0===t.attrs.type&&(t.attrs.type="text/css"),t.attrs.rel="stylesheet",m(e,t.attrs),p(t,e),e}(e),n=function(t,e,i){var n=i.css,s=i.sourceMap,o=void 0===e.convertToAbsoluteUrls&&s;(e.convertToAbsoluteUrls||o)&&(n=u(n));s&&(n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(s))))+" */");var r=new Blob([n],{type:"text/css"}),a=t.href;t.href=URL.createObjectURL(r),a&&URL.revokeObjectURL(a)}.bind(null,i,e),s=function(){g(i),i.href&&URL.revokeObjectURL(i.href)}):(i=f(e),n=function(t,e){var i=e.css,n=e.media;n&&t.setAttribute("media",n);if(t.styleSheet)t.styleSheet.cssText=i;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(i))}}.bind(null,i),s=function(){g(i)});return n(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;n(t=e)}else s()}}t.exports=function(t,e){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(e=e||{}).attrs="object"==typeof e.attrs?e.attrs:{},e.singleton||"boolean"==typeof e.singleton||(e.singleton=r()),e.insertInto||(e.insertInto="head"),e.insertAt||(e.insertAt="bottom");var i=v(t,e);return l(i,e),function(t){for(var n=[],s=0;s<i.length;s++){var r=i[s];(a=o[r.id]).refs--,n.push(a)}t&&l(v(t,e),e);for(s=0;s<n.length;s++){var a;if(0===(a=n[s]).refs){for(var h=0;h<a.parts.length;h++)a.parts[h]();delete o[a.id]}}}};var w,y=(w=[],function(t,e){return w[t]=e,w.filter(Boolean).join("\n")});function b(t,e,i,n){var s=i?"":n.css;if(t.styleSheet)t.styleSheet.cssText=y(e,s);else{var o=document.createTextNode(s),r=t.childNodes;r[e]&&t.removeChild(r[e]),r.length?t.insertBefore(o,r[e]):t.appendChild(o)}}},function(t,e,i){var n=i(6);"string"==typeof n&&(n=[[t.i,n,""]]);var s={hmr:!0,transform:void 0,insertInto:void 0};i(2)(n,s);n.locals&&(t.exports=n.locals)},function(t,e,i){"use strict";(function(t){var i=function(){if("undefined"!=typeof Map)return Map;function t(t,e){var i=-1;return t.some(function(t,n){return t[0]===e&&(i=n,!0)}),i}return function(){function e(){this.__entries__=[]}return Object.defineProperty(e.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),e.prototype.get=function(e){var i=t(this.__entries__,e),n=this.__entries__[i];return n&&n[1]},e.prototype.set=function(e,i){var n=t(this.__entries__,e);~n?this.__entries__[n][1]=i:this.__entries__.push([e,i])},e.prototype.delete=function(e){var i=this.__entries__,n=t(i,e);~n&&i.splice(n,1)},e.prototype.has=function(e){return!!~t(this.__entries__,e)},e.prototype.clear=function(){this.__entries__.splice(0)},e.prototype.forEach=function(t,e){void 0===e&&(e=null);for(var i=0,n=this.__entries__;i<n.length;i++){var s=n[i];t.call(e,s[1],s[0])}},e}()}(),n="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,s=void 0!==t&&t.Math===Math?t:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),o="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(s):function(t){return setTimeout(function(){return t(Date.now())},1e3/60)},r=2;var a=20,h=["top","right","bottom","left","width","height","size","weight"],c="undefined"!=typeof MutationObserver,d=function(){function t(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(t,e){var i=!1,n=!1,s=0;function a(){i&&(i=!1,t()),n&&c()}function h(){o(a)}function c(){var t=Date.now();if(i){if(t-s<r)return;n=!0}else i=!0,n=!1,setTimeout(h,e);s=t}return c}(this.refresh.bind(this),a)}return t.prototype.addObserver=function(t){~this.observers_.indexOf(t)||this.observers_.push(t),this.connected_||this.connect_()},t.prototype.removeObserver=function(t){var e=this.observers_,i=e.indexOf(t);~i&&e.splice(i,1),!e.length&&this.connected_&&this.disconnect_()},t.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},t.prototype.updateObservers_=function(){var t=this.observers_.filter(function(t){return t.gatherActive(),t.hasActive()});return t.forEach(function(t){return t.broadcastActive()}),t.length>0},t.prototype.connect_=function(){n&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),c?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},t.prototype.disconnect_=function(){n&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},t.prototype.onTransitionEnd_=function(t){var e=t.propertyName,i=void 0===e?"":e;h.some(function(t){return!!~i.indexOf(t)})&&this.refresh()},t.getInstance=function(){return this.instance_||(this.instance_=new t),this.instance_},t.instance_=null,t}(),u=function(t,e){for(var i=0,n=Object.keys(e);i<n.length;i++){var s=n[i];Object.defineProperty(t,s,{value:e[s],enumerable:!1,writable:!1,configurable:!0})}return t},l=function(t){return t&&t.ownerDocument&&t.ownerDocument.defaultView||s},v=w(0,0,0,0);function p(t){return parseFloat(t)||0}function g(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];return e.reduce(function(e,i){return e+p(t["border-"+i+"-width"])},0)}function f(t){var e=t.clientWidth,i=t.clientHeight;if(!e&&!i)return v;var n=l(t).getComputedStyle(t),s=function(t){for(var e={},i=0,n=["top","right","bottom","left"];i<n.length;i++){var s=n[i],o=t["padding-"+s];e[s]=p(o)}return e}(n),o=s.left+s.right,r=s.top+s.bottom,a=p(n.width),h=p(n.height);if("border-box"===n.boxSizing&&(Math.round(a+o)!==e&&(a-=g(n,"left","right")+o),Math.round(h+r)!==i&&(h-=g(n,"top","bottom")+r)),!function(t){return t===l(t).document.documentElement}(t)){var c=Math.round(a+o)-e,d=Math.round(h+r)-i;1!==Math.abs(c)&&(a-=c),1!==Math.abs(d)&&(h-=d)}return w(s.left,s.top,a,h)}var m="undefined"!=typeof SVGGraphicsElement?function(t){return t instanceof l(t).SVGGraphicsElement}:function(t){return t instanceof l(t).SVGElement&&"function"==typeof t.getBBox};function x(t){return n?m(t)?function(t){var e=t.getBBox();return w(0,0,e.width,e.height)}(t):f(t):v}function w(t,e,i,n){return{x:t,y:e,width:i,height:n}}var y=function(){function t(t){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=w(0,0,0,0),this.target=t}return t.prototype.isActive=function(){var t=x(this.target);return this.contentRect_=t,t.width!==this.broadcastWidth||t.height!==this.broadcastHeight},t.prototype.broadcastRect=function(){var t=this.contentRect_;return this.broadcastWidth=t.width,this.broadcastHeight=t.height,t},t}(),b=function(){return function(t,e){var i,n,s,o,r,a,h,c=(n=(i=e).x,s=i.y,o=i.width,r=i.height,a="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,h=Object.create(a.prototype),u(h,{x:n,y:s,width:o,height:r,top:s,right:n+o,bottom:r+s,left:n}),h);u(this,{target:t,contentRect:c})}}(),C=function(){function t(t,e,n){if(this.activeObservations_=[],this.observations_=new i,"function"!=typeof t)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=t,this.controller_=e,this.callbackCtx_=n}return t.prototype.observe=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(t instanceof l(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var e=this.observations_;e.has(t)||(e.set(t,new y(t)),this.controller_.addObserver(this),this.controller_.refresh())}},t.prototype.unobserve=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(t instanceof l(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var e=this.observations_;e.has(t)&&(e.delete(t),e.size||this.controller_.removeObserver(this))}},t.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},t.prototype.gatherActive=function(){var t=this;this.clearActive(),this.observations_.forEach(function(e){e.isActive()&&t.activeObservations_.push(e)})},t.prototype.broadcastActive=function(){if(this.hasActive()){var t=this.callbackCtx_,e=this.activeObservations_.map(function(t){return new b(t.target,t.broadcastRect())});this.callback_.call(t,e,t),this.clearActive()}},t.prototype.clearActive=function(){this.activeObservations_.splice(0)},t.prototype.hasActive=function(){return this.activeObservations_.length>0},t}(),E="undefined"!=typeof WeakMap?new WeakMap:new i,P=function(){return function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var i=d.getInstance(),n=new C(e,i,this);E.set(this,n)}}();["observe","unobserve","disconnect"].forEach(function(t){P.prototype[t]=function(){var e;return(e=E.get(this))[t].apply(e,arguments)}});var N=void 0!==s.ResizeObserver?s.ResizeObserver:P;e.a=N}).call(this,i(8))},function(t,e,i){var n=i(9);"string"==typeof n&&(n=[[t.i,n,""]]);var s={hmr:!0,transform:void 0,insertInto:void 0};i(2)(n,s);n.locals&&(t.exports=n.locals)},function(t,e,i){(e=t.exports=i(1)(!1)).push([t.i,".style-18Hmg {\n  background: white;\n  position: fixed;\n  width: 160px;\n  min-height: 160px;\n  border-radius: 5px;\n  z-index: 9999;\n  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.175);\n  border: 1px solid rgba(0, 0, 0, 0.15);\n  font-size: 14px;\n  padding: 10px 0;\n  color: #666;\n}\n.style-18Hmg .item {\n  height: 26px;\n  line-height: 26px;\n  padding: 3px 20px;\n  cursor: pointer;\n}\n.style-18Hmg .item:hover {\n  background: #f6f6f6;\n  color: #0796e9;\n}\n",""]),e.locals={menu:"style-18Hmg"}},function(t,e){t.exports=function(t){var e="undefined"!=typeof window&&window.location;if(!e)throw new Error("fixUrls requires window.location");if(!t||"string"!=typeof t)return t;var i=e.protocol+"//"+e.host,n=i+e.pathname.replace(/\/[^\/]*$/,"/");return t.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(t,e){var s,o=e.trim().replace(/^"(.*)"$/,function(t,e){return e}).replace(/^'(.*)'$/,function(t,e){return e});return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(o)?t:(s=0===o.indexOf("//")?o:0===o.indexOf("/")?i+o:n+o.replace(/^\.\//,""),"url("+JSON.stringify(s)+")")})}},function(t,e){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e,i){(e=t.exports=i(1)(!1)).push([t.i,".canvas-1iCxA {\n  width: 100%;\n  height: 100%;\n  position: relative;\n}\n.canvas-1iCxA > div,\n.canvas-1iCxA canvas {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  top: 0;\n  left: 0;\n  overflow: hidden;\n}\n.canvas-1iCxA .hidden {\n  display: none !important;\n}\n",""]),e.locals={topology:"canvas-1iCxA"}},function(t,e,i){"use strict";i.r(e);var n=i(0),s=i.n(n),o=i(3),r=i.n(o);class a{static copy(t){return h>d.length-1&&(h=0),d[h++].copy(t)}constructor(t=0,e=0){s()(this,"x",void 0),s()(this,"y",void 0),this.x=t,this.y=e}get magnitude(){return this.getMagnitude()}getMagnitude(){return 0===this.x&&0===this.y?1e-9:Math.sqrt(this.x*this.x+this.y*this.y)}add(t){return this.x+=t.x,this.y+=t.y,this}substract(t){return this.x-=t.x,this.y-=t.y,this}dotProduct(t){return this.x*t.x+this.y*t.y}crossProduct(t){return this.x*t.y-this.y*t.x}scale(t){return this.x*=t,this.y*=t,this}edge(t){return this.clone().substract(t)}perpendicular(){return new a(this.y,-this.x)}normalize(){const t=this.getMagnitude();return new a(this.x/t,this.y/t)}normal(){return this.perpendicular().normalize()}cosAngle(t){return this.dotProduct(t)/(this.magnitude*t.magnitude)}angle(t){return Math.acos(this.cosAngle(t))}xAxisAngle(){const t=this.angle(a.xAxis);return this.y>0?t:-t}rotate(t){const{x:e,y:i}=this;return this.x=e*Math.cos(t)-i*Math.sin(t),this.y=e*Math.sin(t)+i*Math.cos(t),this}project(t){const e=this.dotProduct(t)/t.magnitude;return t.normalize().scale(e)}equal(t){return this.x===t.x&&this.y===t.y}distance(t){return this.edge(t).magnitude}copy(t){return this.x=t.x,this.y=t.y,this}clone(){return new a(this.x,this.y)}}s()(a,"xAxis",new a(1,0)),s()(a,"yAxis",new a(0,1));let h=0,c=1e3;const d=[];for(;c--;)d.push(new a);var u=a;const l=[{label:"放大",command:"zoomIn"},{label:"缩小",command:"zoomOut"}];class v{constructor(t){s()(this,"mouseX",0),s()(this,"mouseY",0),s()(this,"canvas",void 0),s()(this,"mounted",!1),s()(this,"container",document.createElement("div")),s()(this,"menu",l),s()(this,"handleClick",t=>{t.stopPropagation();const e=t.target;if(!e)return;if(e===this.container)return;const i=e.dataset.command;switch(i){case"zoomIn":this.canvas.zoomIn(new a(this.mouseX,this.mouseY));break;case"zoomOut":this.canvas.zoomOut(new a(this.mouseX,this.mouseY));break;default:const t=this.menu.find(t=>t.command===i);this.canvas.eventEmitter.emit("canvas:menu",t)}this.hide()}),s()(this,"handleDocumentClick",t=>{this.hide()}),this.canvas=t,this.container.className=r.a.menu,this.container.addEventListener("click",this.handleClick),document.addEventListener("click",this.handleDocumentClick)}destroy(){this.container.removeEventListener("click",this.handleClick),document.removeEventListener("click",this.handleDocumentClick),this.unmount()}show(t,e){this.mouseX=t,this.mouseY=e;let i=t,n=e;Object.assign(this.container.style,{left:`${i}px`,top:`${n}px`}),this.mount()}hide(){this.unmount()}mount(){if(this.mounted)return;const t=[...this.menu].map(t=>`<div class="item" data-command="${t.command}">${t.label}</div>`);this.container.innerHTML=t.join(""),document.body.appendChild(this.container),this.mounted=!0}unmount(){this.mounted&&(document.body.removeChild(this.container),this.mounted=!1)}}class p{constructor(){s()(this,"events",{})}on(t,e){this.events[t]=this.events[t]||[],this.events[t].push(e)}off(t,e){if(!this.events[t])return;const i=this.events[t].findIndex(t=>t===e);this.events[t].splice(i,1)}emit(t,e){this.events[t]&&this.events[t].forEach(t=>{t(e)})}clear(){Object.keys(this.events).forEach(t=>{delete this.events[t]})}}let g=1;var f=class{get visible(){return this._visible}set visible(t){this._visible=t}constructor(t){s()(this,"canvas",void 0),s()(this,"active",!1),s()(this,"_visible",void 0),s()(this,"zIndex",void 0),s()(this,"isUpdate",!0),s()(this,"graphId",g++),s()(this,"data",void 0),s()(this,"renderSign",void 0),this._visible=t.visible||!0,this.zIndex=t.zIndex||0,this.data=t.data}isInRect(t){return!1}isWrappedInRect(t){return!1}isWrappedInCircle(){return!1}render(){}update(){}destroy(){}beforeDestroy(){}};class m extends f{getPosition(){return this.position}get visible(){return!!this._visible&&!!(!this.parent||this.parent.visible&&this.parent.isExpanded)}set visible(t){this._visible=t}constructor(t){super(t),s()(this,"id",void 0),s()(this,"position",void 0),s()(this,"renderType",void 0),s()(this,"shapeType",void 0),s()(this,"isGroup",!1),s()(this,"isExpanded",!0),s()(this,"canResize",!1),s()(this,"children",[]),s()(this,"parent",void 0),s()(this,"edges",[]),this.position=new a(t.x,t.y),this.id=t.id}translate(t){this.position.add(t),this.isUpdate=!0,this.children.forEach(e=>{e.translate(t)})}addEdge(t){this.edges.find(e=>e===t)||this.edges.push(t)}removeEdge(t){const e=this.edges.findIndex(e=>e===t);e>-1&&this.edges.splice(e,1)}addChild(t){if(t.hasDescendant(this))return;if(this.hasChild(t))return;let e=this.children.length-1,i=this.children[e];for(;i;){if(i.zIndex<=t.zIndex)return this.addChildAt(t,e+1);e--,i=this.children[e]}return this.addChildAt(t,0)}addChildAt(t,e){return e>=0&&e<=this.children.length?(t.parent&&t.parent.removeChild(t,!1),t.parent=this,this.children.splice(e,0,t),this.canvas&&(t.canvas=this.canvas,t.render(),t.getDescendantBF(t=>{t.canvas=this.canvas,t.render()})),t):void 0}removeChild(t,e=!0){const i=this.children.findIndex(e=>e===t);return-1!==i&&(e&&t.destroy(),t.canvas=void 0,this.children.splice(i,1),!0)}removeAllChild(t=!0){[...this.children].forEach(e=>{this.removeChild(e,t)})}hasChild(t){return!!this.children.find(e=>e===t)}hasDescendant(t){let e=!1;return this.getDescendantBF(i=>{if(i===t)return e=!0}),e}hasActiveAncestor(){return!!this.parent&&(this.parent.active||this.parent.hasActiveAncestor())}getChildById(t){return this.children.find(e=>e.id===t)}getActiveChild(){return this.children.filter(t=>t.active)}getActiveDescendant(){const t=[];return this.getDescendantBF(e=>{e.active&&t.push(e)}),t}getDescendantDF(t){let e=!1;const i=[];return function t(n){for(let s=this.children.length-1;s>=0;s--){const o=this.children[s];if(t.call(o,n),e)return i;if(i.push(o),n&&n(o))return e=!0,i}return i}.call(this,t)}getDescendantBF(t){const e=[],i=[...this.children];for(;i.length;){const n=i.shift();if(e.push(n),i.push(...n.children),t&&t(n))break}return e}get root(){let t=this;for(;void 0!==t.parent;)t=t.parent;return t}get depth(){let t=0,e=this;for(;void 0!==e.parent;)e=e.parent,t++;return t}get firstChild(){return this.children[0]}get lastChild(){return this.children[this.children.length-1]}}var x=m;class w extends x{constructor(t){super(t),s()(this,"renderType","CANVAS"),s()(this,"cacheCanvas",document.createElement("canvas"))}destroy(){this.removeAllChild(),this.beforeDestroy()}}var y=w;class b extends x{constructor(t){super(t),s()(this,"renderType","DOM"),s()(this,"mounted",!1),s()(this,"$el",document.createElement("div")),Object.assign(this.$el.style,{position:"absolute",left:0,top:0})}mount(){!this.mounted&&this.canvas&&(this.mounted=!0,this.canvas.domCanvas.appendChild(this.$el))}unmount(){this.mounted&&this.canvas&&(this.mounted=!1,this.canvas.domCanvas.removeChild(this.$el))}isPointIn(){const{canvas:t}=this;if(!t)return!1;if(!t.nativeEvent)return!1;let e=t.nativeEvent.target,i=!1;for(;e&&!i;)e===this.$el&&(i=!0),e=e.parentElement;return i}update(){const{x:t,y:e}=this.getPosition();this.$el.style.transform=`translate3d(${t}px,${e}px,0)`}destroy(){this.removeAllChild(),this.beforeDestroy(),this.unmount()}}var C=b;function E(t){let e=!1;return function(...i){e||(e=!0,t(...i),requestAnimationFrame(()=>{e=!1}))}}function P(t){return new Promise((e,i)=>{const n=new Image;n.src=t,n.onload=(()=>{e(n)}),n.onerror=(()=>{i()})})}function N(t,e){e.forEach(e=>{Object.getOwnPropertyNames(e.prototype).forEach(i=>{"constructor"!==i&&(t.prototype[i]=e.prototype[i])})})}var M=i(4);var I=class extends x{constructor(t){super(t),s()(this,"renderType","NONE"),s()(this,"shapeType","circle"),s()(this,"radius",0)}get vertexes(){return[this.position,this.position,this.position,this.position]}get boundingRect(){return[this.position,this.position,this.position,this.position]}get boundingJoinPoints(){return[this.position]}get joinPoint(){return this.position}get centerPoint(){return this.position}get depth(){return Number.MAX_SAFE_INTEGER}isInRect(){return!1}isPointIn(){return!1}render(){}destroy(){}updatePosition(){}updateRender(){}};function _(t,e){}function T(t){}class D{constructor(){s()(this,"onClick",_),s()(this,"onMouseDown",_),s()(this,"onMouseMove",_),s()(this,"onMouseUp",_),s()(this,"onDrop",_),s()(this,"onDragOver",_),s()(this,"onWheel",_),s()(this,"onContextMenu",_),s()(this,"onDblClick",_),s()(this,"onInstall",T),s()(this,"onUninstall",T),s()(this,"onUpdate",T)}}var A=D;class R extends A{constructor(...t){super(...t),s()(this,"minDragDistance",3),s()(this,"moveNodes",[]),s()(this,"mousedown",!1),s()(this,"lastCoordinate",new u),s()(this,"onMouseDown",t=>{const e=t.getActiveNodes();e.length?this.moveNodes=[...e]:this.moveNodes=[...t.rootNode.children],this.mousedown=!0,this.lastCoordinate.copy(t.mousedownPosition)}),s()(this,"onMouseMove",t=>{if(!this.mousedown)return;if(u.copy(t.mousemovePosition).substract(t.mousedownPosition).magnitude<this.minDragDistance)return;const e=u.copy(t.mousemovePosition).substract(this.lastCoordinate);this.lastCoordinate.copy(t.mousemovePosition);const i=e.scale(1/t.canvasScale);this.moveNodes.forEach(t=>{t.translate(i)}),t.repaint=!0}),s()(this,"onMouseUp",t=>{if(1===this.moveNodes.length){const e=this.moveNodes[0];let i=!1;t.rootNode.getDescendantDF(t=>{if(t.visible&&t!==e&&t.isGroup&&!e.hasDescendant(t))return e.isWrappedInRect(t.boundingRect)?(t.addChild(e),i=!0):void 0}),i||t.rootNode.addChild(e)}this.moveNodes=[],this.mousedown=!1})}}const S=new R;var O=S;class k extends A{constructor(...t){super(...t),s()(this,"onDrop",(t,e)=>{const i=e;t.eventEmitter.emit("canvas:drop",{coordinate:t.viewportToPixelCoordinate(new a(i.clientX,i.clientY)),dataTransfer:i.dataTransfer})}),s()(this,"onDragOver",(t,e)=>{e.preventDefault()})}}const W=new k;class L extends A{constructor(...t){super(...t),s()(this,"minDragDistance",3),s()(this,"moveNodes",[]),s()(this,"mouseDown",!1),s()(this,"move",!1),s()(this,"lastCoordinate",new a),s()(this,"onMouseDown",t=>{this.mouseDown=!0,this.moveNodes=[...t.rootNode.children],this.lastCoordinate.copy(t.mousedownPosition)}),s()(this,"onMouseMove",t=>{if(!this.mouseDown)return;if(a.copy(t.mousemovePosition).substract(t.mousedownPosition).magnitude<this.minDragDistance)return;const e=a.copy(t.mousemovePosition).substract(this.lastCoordinate);this.lastCoordinate.copy(t.mousemovePosition),this.move=!0;const i=e.scale(1/t.canvasScale);this.moveNodes.forEach(t=>{t.translate(i)}),t.repaint=!0}),s()(this,"onMouseUp",t=>{this.moveNodes=[],this.mouseDown=!1,this.move&&(t.eventEmitter.emit("interaction:canvasMoveEnd"),this.move=!1)})}}const H=new L;class B extends A{constructor(...t){super(...t),s()(this,"onWheel",(t,e)=>{const{deltaY:i,clientX:n,clientY:s}=e;e.preventDefault(),i>0?t.zoomOut(new a(n,s)):t.zoomIn(new a(n,s))})}}const z=new B;class U extends f{constructor(t){super(t),s()(this,"renderType","CANVAS"),s()(this,"targetNode",void 0),s()(this,"sourceNode",void 0),this.targetNode=t.targetNode,this.sourceNode=t.sourceNode}getTargetNode(){let t=this.targetNode;for(;!t.visible&&t.parent&&"NONE"!==t.parent.renderType;)t=t.parent;return t}getSourceNode(){let t=this.sourceNode;for(;!t.visible&&t.parent&&"NONE"!==t.parent.renderType;)t=t.parent;return t}}class j{static isPointInRect(t,e,i,n){return!(t.x<e.x)&&(!(t.y<e.y)&&(!(t.x>e.x+i)&&!(t.y>e.y+n)))}static isPointInCircle(t,e,i){return a.copy(e).substract(t).magnitude<=i}static isPointInTriangle(t,e,i,n){const s=a.copy(e).substract(t),o=a.copy(i).substract(t),r=a.copy(n).substract(t),h=s.crossProduct(o)<0,c=o.crossProduct(r)<0,d=r.crossProduct(s)<0;return h===c&&c===d}static isPointInPolygon(t,e){if(e.length<3)return!1;for(let i=2;i<e.length;i++)if(j.isPointInTriangle(t,e[0],e[i-1],e[i]))return!0;return!1}static isPointInLineSegment(t,e,i=.01){const n=e[0],s=e[1],o=a.copy(t).substract(n),r=a.copy(t).substract(s),h=a.copy(n).substract(s);return o.magnitude+r.magnitude-h.magnitude<i}static isPointInPolyline(t,e,i=.01){const n=e.length;if(n<2)return!1;for(let s=1;s<n;s++)if(j.isPointInLineSegment(t,[e[s-1],e[s]],i))return!0;return!1}static isIntersect(t,e){const i=t[0],n=t[1],s=e[0],o=e[1];if(j.isPointInLineSegment(i,e))return!0;if(j.isPointInLineSegment(n,e))return!0;if(j.isPointInLineSegment(s,t))return!0;if(j.isPointInLineSegment(o,t))return!0;const r=a.copy(s).substract(i),h=a.copy(o).substract(i),c=a.copy(s).substract(n),d=a.copy(o).substract(n);if(r.crossProduct(h)<0===c.crossProduct(d)<0)return!1;const u=a.copy(i).substract(s),l=a.copy(n).substract(s),v=a.copy(i).substract(o),p=a.copy(n).substract(o);return u.crossProduct(l)<0!==v.crossProduct(p)<0}static getLineIntersect(t,e){const i=t[0],n=t[1],s=e[0],o=e[1],r=a.copy(n).substract(i),h=a.copy(o).substract(s).perpendicular(),c=s.project(h),d=i.project(h),u=n.project(h),l=a.copy(c).substract(d),v=a.copy(u).substract(c),p=r.magnitude*l.magnitude/(l.magnitude+v.magnitude);return r.normalize().scale(p).add(i)}static getLinePoint(t,e){const i=t.length;if(i<2)return null;e>1&&(e=1),e<0&&(e=0);const n=j.getPolyLineLength(t)*e;let s=0;for(let e=1;e<i;e++)if((s+=t[e].distance(t[e-1]))>=n){const i=s-n;return a.copy(t[e]).add(a.copy(t[e-1]).substract(t[e]).normalize().scale(i))}return new a(0,0)}static getPolyLineLength(t){const e=t.length;if(e<2)return 0;let i=0;for(let n=1;n<e;n++)i+=t[n].distance(t[n-1]);return i}}var F=j;class J extends U{constructor(t){super(t),s()(this,"dash",void 0),s()(this,"text",void 0),s()(this,"arrow",void 0),s()(this,"rotate",0),s()(this,"begin",void 0),s()(this,"end",void 0),this.dash=t.dash||!1,this.text=t.text||"",this.arrow=t.arrow||!1}isInRect(){return!0}isPointIn(){const t=this.getTargetNode(),e=this.getSourceNode();if(!t.visible&&!e.visible)return!1;const{canvas:i}=this;if(!i)return!1;if(!i.nativeEvent)return!1;if(!this.begin||!this.end)return!1;const n=i.nativeEvent,s=new a(n.clientX,n.clientY),o=i.viewportToPixelCoordinate(s);if(j.isPointInLineSegment(o,[this.begin,this.end],.1))return!0;if(this.arrow){const t=new a(0,0).rotate(this.rotate),e=new a(-10,4).rotate(this.rotate),i=new a(-10,-4).rotate(this.rotate);if(j.isPointInTriangle(a.copy(o).substract(this.end),t,e,i))return!0}if(this.text){const{graphCanvasCtx:t}=i;t.save(),t.font="14px sans-serif";const e=t.measureText(this.text).width,n=a.copy(this.end).substract(this.begin),s=n.normalize(),r=a.copy(this.begin).add(a.copy(n).scale(.5)),h=n.perpendicular().normalize();if(t.restore(),this.rotate<Math.PI/2&&this.rotate>=-Math.PI/2){const t=a.copy(r).substract(a.copy(s).scale(e/2)).add(a.copy(h).scale(17)),i=a.copy(t).add(a.copy(s).scale(e)),n=a.copy(i).substract(a.copy(h).scale(14)),c=a.copy(n).substract(a.copy(s).scale(e));if(j.isPointInPolygon(o,[t,i,n,c]))return!0}else{const t=a.copy(r).substract(a.copy(s).scale(e/2)).add(a.copy(h).scale(-17)),i=a.copy(t).add(a.copy(s).scale(e)),n=a.copy(i).substract(a.copy(h).scale(-14)),c=a.copy(n).substract(a.copy(s).scale(e));if(j.isPointInPolygon(o,[t,i,n,c]))return!0}}return!1}render(){if(!this.canvas)return;const{graphCanvasCtx:t}=this.canvas,e=this.getTargetNode(),i=this.getSourceNode();if(i.visible||e.visible){const n=i.centerPoint,s=e.centerPoint,o=[n,s];if(this.begin="rect"===i.shapeType?$(o,i.boundingRect):G(n,i.radius,s),!this.begin)return;if(this.end="rect"===e.shapeType?$(o,e.boundingRect):G(s,e.radius,n),!this.end)return;const r=a.copy(s).substract(n);if(t.save(),t.beginPath(),t.moveTo(this.begin.x,this.begin.y),t.lineTo(this.end.x,this.end.y),t.strokeStyle=this.active?"#e96160":"#29c1f8",t.fillStyle=this.active?"#e96160":"#29c1f8",this.dash&&t.setLineDash([4,4]),t.stroke(),this.rotate=r.xAxisAngle(),this.text){t.save();const e=a.copy(n).add(a.copy(r).scale(.5));t.font="14px sans-serif",t.textAlign="center",t.textBaseline="middle",t.translate(e.x,e.y),this.rotate<Math.PI/2&&this.rotate>=-Math.PI/2?t.rotate(this.rotate):t.rotate(this.rotate-Math.PI),t.fillText(this.text,0,-10),t.restore()}this.arrow&&(t.beginPath(),t.save(),t.translate(this.end.x,this.end.y),t.rotate(this.rotate),t.moveTo(0,0),t.lineTo(-10,4),t.lineTo(-10,-4),t.closePath(),t.fill(),t.restore()),t.restore()}}}function $(t,e){const i=e.length;for(let n=0;n<i;n++){const s=e[n],o=n===i-1?e[0]:e[n+1];if(j.isIntersect(t,[s,o]))return j.getLineIntersect([s,o],t)}}function G(t,e,i){const n=a.copy(i).substract(t);if(n.magnitude<e)return;const s=n.xAxisAngle();return t.add(new a(e*Math.cos(s),e*Math.sin(s)))}var X=J;class Y extends A{constructor(t){super(),s()(this,"targetNode",void 0),s()(this,"sourceNode",void 0),s()(this,"edge",void 0),s()(this,"text",""),s()(this,"arrow",!1),s()(this,"dash",!1),s()(this,"onMouseUp",t=>{this.edge?(t.rootNode.getDescendantDF(t=>{if(t.isPointIn())return this.targetNode=t,!0}),this.targetNode&&this.sourceNode&&this.targetNode!==this.sourceNode&&!this.targetNode.hasDescendant(this.sourceNode)&&this.sourceNode.hasDescendant(this.targetNode)?(this.edge.targetNode=this.targetNode,this.targetNode.addEdge(this.edge),t.virtualNode.removeEdge(this.edge),this.targetNode.isUpdate=!0,this.edge=void 0,this.targetNode=void 0,this.sourceNode=void 0):(t.removeEdge(this.edge),this.edge=void 0,this.targetNode=void 0,this.sourceNode=void 0)):(t.rootNode.getDescendantDF(t=>{if(t.isPointIn())return this.sourceNode=t,!0}),this.sourceNode&&(this.edge=new X({sourceNode:this.sourceNode,targetNode:t.virtualNode,arrow:this.arrow,text:this.text,dash:this.dash}),t.addEdge(this.edge))),t.repaint=!0}),s()(this,"onMouseMove",t=>{t.virtualNode.position=t.viewportToPixelCoordinate(t.mousemovePosition),this.sourceNode&&(t.virtualNode.isUpdate=!0),t.repaint=!0}),s()(this,"onUninstall",t=>{this.edge&&(t.removeEdge(this.edge),this.edge=void 0,this.targetNode=void 0,this.sourceNode=void 0),t.repaint=!0}),t&&(this.text=t.text||"",this.arrow=t.arrow||!1,this.dash=t.dash||!1)}}const V=new Y;let q=new a,Z=new a,K=new a;class Q extends U{constructor(t){super(t),s()(this,"dash",void 0),s()(this,"text",void 0),s()(this,"arrow",void 0),s()(this,"arrowStart",void 0),s()(this,"rotate",0),s()(this,"middlePoints",[]),s()(this,"centerPoint",null),s()(this,"sourceJoinPoint",void 0),s()(this,"targetJoinPoint",void 0),s()(this,"isInRect",()=>!0),this.dash=t.dash||!1,this.text=t.text||"",this.arrow=t.arrow||!1}isPointIn(){const t=this.getSourceNode(),e=this.getTargetNode();if(!t.visible&&!e.visible)return!1;const{canvas:i}=this;if(!i)return!1;if(!i.nativeEvent)return!1;if(!this.sourceJoinPoint||!this.targetJoinPoint)return!1;const n=i.nativeEvent,s=new a(n.clientX,n.clientY),o=i.viewportToPixelCoordinate(s);if(K.copy(o),j.isPointInPolyline(o,[this.sourceJoinPoint,...this.middlePoints,this.targetJoinPoint],.1))return!0;if(this.arrow&&this.arrowStart){const t=new a(0,0).rotate(this.rotate),e=new a(-10,4).rotate(this.rotate),i=new a(-10,-4).rotate(this.rotate);if(j.isPointInTriangle(K.substract(this.arrowStart),t,e,i))return!0}if(this.text&&this.centerPoint){const{graphCanvasCtx:t}=i;t.font="14px sans-serif";const e=t.measureText(this.text).width,n=this.centerPoint.x-e/2,s=this.centerPoint.y-7,r=[new a(n,s),new a(n+e,s),new a(n+e,s+14),new a(n,s+14)];if(j.isPointInPolygon(o,r))return!0}return!1}render(){if(!this.canvas)return;const{graphCanvasCtx:t}=this.canvas,e=this.getSourceNode(),i=this.getTargetNode();if(e.visible||i.visible){const n=e.boundingJoinPoints,s=i.boundingJoinPoints;let o=0;if(this.sourceJoinPoint=void 0,this.targetJoinPoint=void 0,n.forEach(t=>{s.forEach(e=>{const i=t.distance(e);(o>i||!this.sourceJoinPoint||!this.targetJoinPoint)&&(o=i,this.sourceJoinPoint=t,this.targetJoinPoint=e)})}),!this.sourceJoinPoint||!this.targetJoinPoint)return;const r=this.sourceJoinPoint,h=this.targetJoinPoint;q.copy(r);const c=q.substract(e.centerPoint).normalize();Z.copy(i.centerPoint);const d=Z.substract(h).normalize();if(1===c.x||-1===c.x)if(1===d.x||-1===d.x){const t=(r.x+h.x)/2;this.middlePoints=[new a(t,r.y),new a(t,h.y)]}else this.middlePoints=[new a(h.x,r.y)];else if(1===d.x||-1===d.x)this.middlePoints=[new a(r.x,h.y)];else{const t=(r.y+h.y)/2;this.middlePoints=[new a(r.x,t),new a(h.x,t)]}if(t.save(),this.dash&&t.setLineDash([4,4]),t.beginPath(),t.moveTo(r.x,r.y),this.middlePoints.forEach(e=>{t.lineTo(e.x,e.y)}),t.lineTo(h.x,h.y),t.strokeStyle=this.active?"#e96160":"#29c1f8",t.stroke(),this.text&&(this.centerPoint=j.getLinePoint([r,...this.middlePoints,h],.5),this.centerPoint)){t.beginPath(),t.font="14px sans-serif",t.textBaseline="top";const e=t.measureText(this.text).width,i=this.centerPoint.x-e/2,n=this.centerPoint.y-7;t.rect(i,n,e,14),t.fillStyle="#fff",t.fill(),t.fillStyle=this.active?"#e96160":"#29c1f8",t.fillText(this.text,i,n)}this.arrow&&(this.arrowStart=h,this.rotate=d.xAxisAngle(),t.beginPath(),t.save(),t.translate(this.arrowStart.x,this.arrowStart.y),t.rotate(this.rotate),t.moveTo(0,0),t.lineTo(-10,4),t.lineTo(-10,-4),t.closePath(),t.fillStyle=this.active?"#e96160":"#29c1f8",t.fill(),t.restore()),t.restore()}}}var tt=Q;class et extends A{constructor(...t){super(...t),s()(this,"targetNode",void 0),s()(this,"sourceNode",void 0),s()(this,"edge",void 0),s()(this,"onMouseUp",t=>{this.edge?(t.rootNode.getDescendantDF(t=>{if(t.isPointIn())return this.targetNode=t,!0}),this.targetNode&&this.sourceNode&&this.targetNode!==this.sourceNode&&!this.targetNode.hasDescendant(this.sourceNode)&&this.sourceNode.hasDescendant(this.targetNode)?(this.edge.targetNode=this.targetNode,this.targetNode.addEdge(this.edge),t.virtualNode.removeEdge(this.edge),this.edge.arrow=!0,this.targetNode.isUpdate=!0,this.edge=void 0,this.targetNode=void 0,this.sourceNode=void 0):(t.removeEdge(this.edge),this.edge=void 0,this.targetNode=void 0,this.sourceNode=void 0)):(t.rootNode.getDescendantDF(t=>{if(t.isPointIn())return this.sourceNode=t,!0}),this.sourceNode&&(this.edge=new tt({sourceNode:this.sourceNode,targetNode:t.virtualNode,dash:!1,arrow:!1,text:""}),t.addEdge(this.edge))),t.repaint=!0}),s()(this,"onMouseMove",t=>{t.virtualNode.position=t.viewportToPixelCoordinate(t.mousemovePosition),this.sourceNode&&(t.virtualNode.isUpdate=!0),t.repaint=!0}),s()(this,"onUninstall",t=>{this.edge&&(t.removeEdge(this.edge),this.edge=void 0,this.targetNode=void 0,this.sourceNode=void 0),t.repaint=!0})}}const it=new et;class nt extends A{constructor(...t){super(...t),s()(this,"onMouseDown",t=>{let e,i;const n=Math.random();t.rootNode.getDescendantDF(s=>{e||i||!s.visible?s.active=!1:(s.active=s.isPointIn(),s.active&&(e=s,t.setNodeTop(s))),s.isUpdate=!0,s.edges.forEach(t=>{t.renderSign!==n&&(t.renderSign=n,t.active=!1,i||e||(t.sourceNode.visible||t.targetNode.visible)&&(t.active=t.isPointIn(),t.active&&(i=t)))})}),t.repaint=!0})}}const st=new nt;var ot=st;class rt extends A{constructor(...t){super(...t),s()(this,"onContextMenu",(t,e)=>{const i=e;t.contextMenu.hide();const n=t.getActiveNodes(),s=t.getActiveEdges();n.length?t.contextMenu.menu=[{label:"重命名",command:"rename"},{label:"删除",command:"remove"}]:s.length?t.contextMenu.menu=[{label:"删除",command:"remove"}]:t.contextMenu.menu=[{label:"放大",command:"zoomIn"},{label:"缩小",command:"zoomOut"}],t.contextMenu.show(i.clientX,i.clientY)})}}const at=new rt;new R;class ht extends A{constructor(...t){super(...t),s()(this,"minDragDistance",5),s()(this,"mouseDown",!1),s()(this,"activeNodes",[]),s()(this,"dragMove",!1),s()(this,"lastCoordinate",new u),s()(this,"onInstall",t=>{t.topCanvasMount()}),s()(this,"onUninstall",t=>{t.topCanvasCtx.clearRect(0,0,t.viewWidth,t.viewHeight),t.topCanvasUnmount()}),s()(this,"onMouseDown",(t,e)=>{this.dragMove=!1,this.lastCoordinate.copy(t.mousedownPosition);const i=t.getActiveNodes();i.length&&i.find(t=>t.visible&&t.isPointIn())?(this.dragMove=!0,this.activeNodes=i):(this.activeNodes=[],t.rootNode.getDescendantDF(t=>{t.isUpdate=!0,!this.activeNodes.length&&t.visible&&t.isPointIn()?(this.activeNodes.push(t),this.dragMove=!0,t.active=!0):t.active=!1}),t.repaint=!0),this.mouseDown=!0,t.topCanvasCtx.fillStyle="rgba(41, 193, 248, 0.3)",t.topCanvasCtx.strokeStyle="rgb(41, 193, 248)"}),s()(this,"onMouseMove",(t,e)=>{if(this.mouseDown)if(this.dragMove){const e=u.copy(t.mousemovePosition).substract(this.lastCoordinate);this.lastCoordinate.copy(t.mousemovePosition);const i=e.scale(1/t.canvasScale);this.activeNodes.forEach(t=>{t.translate(i)}),t.repaint=!0}else{const{mousedownPosition:e,mousemovePosition:i,topCanvasCtx:n,viewWidth:s,viewHeight:o}=t;if(u.copy(i).substract(e).magnitude<this.minDragDistance)return;const r=t.viewportToCanvasCoordinate(e),a=t.viewportToCanvasCoordinate(i),h=new u(r.x,a.y),c=new u(a.x,r.y);let d,l,v,p;n.clearRect(0,0,s,o),n.beginPath(),n.moveTo(r.x,r.y),n.lineTo(h.x,h.y),n.lineTo(a.x,a.y),n.lineTo(c.x,c.y),n.closePath(),n.fill(),n.stroke(),e.x>i.x?e.y>i.y?(d=t.viewportToPixelCoordinate(i),v=t.viewportToPixelCoordinate(e),l=new u(v.x,d.y),p=new u(d.x,v.y)):(l=t.viewportToPixelCoordinate(e),p=t.viewportToPixelCoordinate(i),d=new u(p.x,l.y),v=new u(l.x,p.y)):e.y>i.y?(l=t.viewportToPixelCoordinate(i),p=t.viewportToPixelCoordinate(e),d=new u(p.x,l.y),v=new u(l.x,p.y)):(d=t.viewportToPixelCoordinate(e),v=t.viewportToPixelCoordinate(i),l=new u(v.x,d.y),p=new u(d.x,v.y));const g=[d,l,v,p];t.rootNode.getDescendantBF(t=>{const e=t.active;t.hasActiveAncestor()?t.active=!1:t.isWrappedInRect(g)?t.active=!0:t.active=!1,e!==t.active&&(t.isUpdate=!0)}),t.repaint=!0}}),s()(this,"onMouseUp",(t,e)=>{if(!this.mouseDown)return;this.dragMove=!1;const{topCanvasCtx:i,viewWidth:n,viewHeight:s}=t;this.mouseDown=!1,i.clearRect(0,0,n,s)})}}const ct=new ht;class dt extends y{constructor(t){super(t),s()(this,"shapeType","rect"),s()(this,"width",void 0),s()(this,"height",void 0),s()(this,"minWidth",void 0),s()(this,"minHeight",void 0),s()(this,"collapseWidth",50),s()(this,"collapseHeight",50),s()(this,"text",void 0),this.width=t.width||100,this.height=t.height||100,this.minWidth=t.minWidth||30,this.minHeight=t.minHeight||30,this.text=t.text||""}get vertexes(){return this.getBoundingRect()}get boundingRect(){return this.getBoundingRect()}get boundingJoinPoints(){return this.getBoundingJoinPoints()}get centerPoint(){return this.getCenterPoint()}getPosition(){if(this.isExpanded)return this.position;{const{x:t,y:e}=this.position;return new u(t+(this.width-this.collapseWidth)/2,e+(this.height-this.collapseHeight)/2)}}getWidth(){return this.isExpanded?this.width:this.collapseWidth}getHeight(){return this.isExpanded?this.height:this.collapseHeight}isPointIn(){const{canvas:t}=this;if(!t)return!1;if(!this.visible)return!1;if(!t.nativeEvent)return!1;const e=t.nativeEvent,i=t.viewportToPixelCoordinate(new u(e.clientX,e.clientY));return F.isPointInRect(i,this.getPosition(),this.getWidth(),this.getHeight())}get joinPoint(){const{x:t,y:e}=this.getPosition();return new u(t+this.getWidth()/2,e+this.getHeight()/2)}getBoundingRect(){const t=this.getWidth(),e=this.getHeight(),{x:i,y:n}=this.getPosition();return[new u(i,n),new u(i+t,n),new u(i+t,n+e),new u(i,n+e)]}getBoundingJoinPoints(){const t=this.getWidth(),e=this.getHeight(),{x:i,y:n}=this.getPosition();return[new u(i+t/2,n),new u(i+t,n+e/2),new u(i+t/2,n+e),new u(i,n+e/2)]}getCenterPoint(){const t=this.getWidth(),e=this.getHeight(),{x:i,y:n}=this.getPosition();return new u(i+t/2,n+e/2)}isInRect(t){const e=this.getBoundingRect();return!(t[0].x>e[2].x)&&(!(t[2].x<e[0].x)&&(!(t[0].y>e[2].y)&&!(t[2].y<e[0].y)))}isWrappedInRect(t){const e=this.getBoundingRect();return t[0].x<=e[0].x&&t[0].y<=e[0].y&&t[2].x>=e[2].x&&t[2].y>=e[2].y}render(){if(!this.canvas)return;const t=this.getWidth(),e=this.getHeight(),i=this.cacheCanvas.getContext("2d");this.cacheCanvas.width=t+4,this.cacheCanvas.height=e+4,i.rect(2,2,t,e),i.strokeStyle="#29c1f8",i.fillStyle="#fff",i.lineWidth=1,i.fill(),i.stroke(),i.textBaseline="middle",i.textAlign="center",i.font="14px serif",i.fillStyle="#29c1f8",i.fillText(this.text,t/2+2,e/2+2),this.canvas.repaint=!0}update(){if(!this.canvas)return;const{graphCanvasCtx:t}=this.canvas,{x:e,y:i}=this.getPosition();t.save(),this.active&&(t.shadowBlur=5,t.shadowColor="rgba(255,0,0,0.8)"),t.drawImage(this.cacheCanvas,e-2,i-2),t.restore()}}class ut extends dt{constructor(t){super(t),s()(this,"isGroup",!0),s()(this,"canResize",!0),"boolean"==typeof t.isExpanded&&(this.isExpanded=t.isExpanded)}render(){}update(){if(!this.canvas)return;const{graphCanvasCtx:t}=this.canvas,e=this.getWidth(),i=this.getHeight(),{x:n,y:s}=this.getPosition(),o=this.centerPoint;t.beginPath(),t.rect(n,s,e,i),this.isExpanded||(t.moveTo(o.x,o.y-10),t.lineTo(o.x,o.y+10),t.moveTo(o.x-10,o.y),t.lineTo(o.x+10,o.y)),t.save(),this.active&&(t.shadowBlur=5,t.shadowColor="rgba(255,0,0,0.8)"),t.strokeStyle="#066df2",t.stroke(),t.restore()}}var lt=ut;class vt extends A{constructor(...t){super(...t),s()(this,"canvas",void 0),s()(this,"parentNode",void 0),s()(this,"onContextMenu",(t,e)=>{const i=e,n=t.getActiveNodes();if(t.contextMenu.hide(),n.length){this.parentNode=void 0,-1===n.findIndex(t=>!!t.parent&&(!(!this.parentNode||this.parentNode===t.parent)||(this.parentNode=t.parent,!1)))&&(t.contextMenu.menu=[{label:"添加到组",command:"addToGroup"}],t.contextMenu.show(i.clientX,i.clientY))}}),s()(this,"onInstall",t=>{this.canvas=t,t.eventEmitter.on("canvas:menu",this.onAddToGroup)}),s()(this,"onUninstall",t=>{t.eventEmitter.off("canvas:menu",this.onAddToGroup)}),s()(this,"onAddToGroup",t=>{if("addToGroup"!==t.command)return;const e=this.canvas.getActiveNodes();if(!e.length)return;const i=new lt({width:200,height:200,id:Math.random(),x:0,y:0});let n=Number.MAX_SAFE_INTEGER,s=Number.MAX_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER;e.forEach(t=>{t.boundingRect.forEach(t=>{t.x<n&&(n=t.x),t.x>o&&(o=t.x),t.y<s&&(s=t.y),t.y>r&&(r=t.y)}),i.addChild(t)}),i.width=o-n+40,i.height=r-s+40,i.position.x=n-20,i.position.y=s-20,console.log(this.parentNode),this.parentNode?(this.parentNode.addChild(i),this.canvas.repaint=!0):this.canvas.addNode(i)})}}new vt;const pt=new u(-3,-3);class gt extends A{constructor(...t){super(...t),s()(this,"activeNode",void 0),s()(this,"flag",!1),s()(this,"activeAnchorIndex",-1),s()(this,"onInstall",t=>{t.topCanvasMount()}),s()(this,"onUninstall",t=>{t.topCanvasCtx.clearRect(0,0,t.viewWidth,t.viewHeight),t.topCanvasUnmount()}),s()(this,"onMouseUp",t=>{this.activeAnchorIndex=-1,O.onMouseUp(t)}),s()(this,"onMouseDown",t=>{if(this.activeAnchorIndex=this.getActiveAnchorIndex(t),-1===this.activeAnchorIndex){ot.onMouseDown(t),O.onMouseDown(t);const e=t.getActiveNodes()[0];e&&e.canResize&&e.isExpanded?this.activeNode=e:this.activeNode=void 0}}),s()(this,"onMouseMove",(t,e)=>{const i=this.activeNode;if(this.activeAnchorIndex>-1&&i){const n=e,s=t.viewportToPixelCoordinate(new u(n.clientX,n.clientY));i.isUpdate=!0,t.repaint=!0,"rect"===i.shapeType?function(t,e,i){const n=t.boundingRect;let s=t.getWidth(),o=t.getHeight();switch(e){case 0:s=n[2].x-i.x,o=n[2].y-i.y,s>=t.minWidth&&(t.position.x=i.x,t.width=s),o>=t.minHeight&&(t.position.y=i.y,t.height=o);break;case 1:s=i.x-n[3].x,o=n[3].y-i.y,s>=t.minWidth&&(t.width=s),o>=t.minHeight&&(t.position.y=i.y,t.height=o);break;case 2:s=i.x-n[0].x,o=i.y-n[0].y,s>=t.minWidth&&(t.width=s),o>=t.minHeight&&(t.height=o);break;case 3:s=n[1].x-i.x,o=i.y-n[1].y,s>=t.minWidth&&(t.position.x=i.x,t.width=s),o>=t.minHeight&&(t.height=o);break;case 4:(o=n[2].y-i.y)>=t.minHeight&&(t.position.y=i.y,t.height=o);break;case 5:(s=i.x-n[0].x)>=t.minWidth&&(t.width=s);break;case 6:(o=i.y-n[0].y)>=t.minHeight&&(t.height=o);break;case 7:(s=n[2].x-i.x)>=t.minWidth&&(t.position.x=i.x,t.width=s)}}(i,this.activeAnchorIndex,s):function(t,e,i){let n=t.radius,s=t.minRadius;const o=t.centerPoint;switch(e){case 0:case 1:case 2:case 3:n=u.copy(i).substract(o).magnitude/Math.sqrt(2);break;case 4:case 5:case 6:case 7:n=u.copy(i).substract(o).magnitude}n>=s&&(t.radius=n,t.position.y=o.y-n,t.position.x=o.x-n)}(i,this.activeAnchorIndex,s),i.render()}else{const e=this.getActiveAnchorIndex(t);let i="default";if(e>-1)switch(e){case 0:i="nwse-resize";break;case 1:i="nesw-resize";break;case 2:i="nwse-resize";break;case 3:i="nesw-resize";break;case 4:i="ns-resize";break;case 5:i="ew-resize";break;case 6:i="ns-resize";break;case 7:i="ew-resize"}else O.onMouseMove(t);t.wrapper.style.cursor=i}}),s()(this,"onUpdate",t=>{if(t.topCanvasCtx.clearRect(0,0,t.viewWidth,t.viewHeight),this.activeNode){const e=[...this.activeNode.boundingRect,...this.activeNode.boundingJoinPoints];t.topCanvasCtx.save(),t.topCanvasCtx.fillStyle="#2D8CF5",t.topCanvasCtx.beginPath(),e.forEach(e=>{const i=t.pixelToCanvasCoordinate(e);t.topCanvasCtx.rect(i.x-3,i.y-3,6,6),t.topCanvasCtx.fill()}),t.topCanvasCtx.restore()}})}getActiveAnchorIndex(t){if(!this.activeNode)return-1;const e=[...this.activeNode.boundingRect,...this.activeNode.boundingJoinPoints];let i=0;return e.find((e,n)=>{const s=t.pixelToViewportCoordinate(e).add(pt);return i=n,F.isPointInRect(t.mousemovePosition,s,6,6)})?i:-1}}new gt;class ft extends A{constructor(...t){super(...t),s()(this,"onDblClick",t=>{const e=t.getActiveNodes()[0];e&&e.isGroup&&(e.isExpanded=!e.isExpanded,e.isUpdate=!0,t.repaint=!0)})}}new ft;const mt="mode.default";const xt=new class{constructor(){s()(this,"modes",{})}registerMode(t,e){this.modes[t]=e}unregisterMode(t){delete this.modes[t]}use(t){return this.modes[t]||[]}hasMode(t){return this.modes.hasOwnProperty(t)}};xt.registerMode(mt,[new nt,new R,new k,new B,new rt,new ft]),xt.registerMode("mode.view",[new L,new B]),xt.registerMode("mode.create.edge",[new nt,new B,new Y({arrow:!0}),new L]),xt.registerMode("mode.create.L",[new nt,new B,new et,new L]),xt.registerMode("mode.area.pick",[new B,new ht,new vt]),xt.registerMode("mode.border",[new gt,new B]);var wt=xt,yt=i(5),bt=i.n(yt);class Ct{static registerMode(t,e){wt.registerMode(t,e)}constructor(t){s()(this,"mounted",!1),s()(this,"_running",!1),s()(this,"_animationFrameId",0),s()(this,"name","application"),s()(this,"eventEmitter",new p),s()(this,"nativeEvent",null),s()(this,"optimize",!0),s()(this,"interactionMode",mt),s()(this,"container",void 0),s()(this,"wrapper",document.createElement("div")),s()(this,"containerClientRect",void 0),s()(this,"graphCanvas",document.createElement("canvas")),s()(this,"graphCanvasCtx",void 0),s()(this,"domCanvas",document.createElement("div")),s()(this,"topCanvas",document.createElement("canvas")),s()(this,"topCanvasMounted",!1),s()(this,"topCanvasCtx",void 0),s()(this,"virtualNode",new I({x:0,y:0,id:"vn"})),s()(this,"mousedownPosition",new a(0,0)),s()(this,"mouseupPosition",new a(0,0)),s()(this,"mousemovePosition",new a(0,0)),s()(this,"ro",void 0),s()(this,"viewWidth",0),s()(this,"viewHeight",0),s()(this,"canvasWidth",0),s()(this,"canvasHeight",0),s()(this,"canvasScale",void 0),s()(this,"maxScale",void 0),s()(this,"minScale",void 0),s()(this,"repaint",!1),s()(this,"contextMenu",new v(this)),s()(this,"rootNode",new I({x:0,y:0,id:"rootNode"})),s()(this,"handleMouseEnter",t=>{this.getBoundingClientRect()}),s()(this,"handleClick",t=>{this.nativeEvent=t;const e=wt.use(this.interactionMode);e&&e.forEach(e=>{e.onClick(this,t)}),this.eventEmitter.emit("canvas:click",t)}),s()(this,"handleDblClick",t=>{this.nativeEvent=t;const e=wt.use(this.interactionMode);e&&e.forEach(e=>{e.onDblClick(this,t)}),this.eventEmitter.emit("canvas:dblclick")}),s()(this,"handleWheel",t=>{const e=wt.use(this.interactionMode);e&&e.forEach(e=>{e.onWheel(this,t)}),this.eventEmitter.emit("canvas:wheel",t)}),s()(this,"handleMouseDown",t=>{this.nativeEvent=t,this.mousedownPosition=new a(t.clientX,t.clientY),this.getBoundingClientRect();const e=wt.use(this.interactionMode);e&&e.forEach(e=>{e.onMouseDown(this,t)}),this.eventEmitter.emit("canvas:mousedown",t)}),s()(this,"handleMouseMove",E(t=>{this.nativeEvent=t,this.mousemovePosition=new a(t.clientX,t.clientY);const e=wt.use(this.interactionMode);e&&e.forEach(e=>{e.onMouseMove(this,t)}),this.optimizeNode(),this.eventEmitter.emit("canvas:mousemove",t)})),s()(this,"handleMouseUp",t=>{this.nativeEvent=t,this.mouseupPosition=new a(t.clientX,t.clientY);const e=wt.use(this.interactionMode);e&&e.forEach(e=>{e.onMouseUp(this,t)}),this.eventEmitter.emit("canvas:mouseup",t)}),s()(this,"handleDragOver",t=>{const e=wt.use(this.interactionMode);e&&e.forEach(e=>{e.onDragOver(this,t)})}),s()(this,"handleDrop",t=>{this.getBoundingClientRect();const e=wt.use(this.interactionMode);e&&e.forEach(e=>{e.onDrop(this,t)})}),s()(this,"handleContextMenu",t=>{t.preventDefault();const e=wt.use(this.interactionMode);e&&e.forEach(e=>{e.onContextMenu(this,t)})}),this.container=t.container,this.wrapper.className=bt.a.topology,this.graphCanvasCtx=this.graphCanvas.getContext("2d"),this.topCanvasCtx=this.topCanvas.getContext("2d"),this.canvasScale=t.scale||1,this.maxScale=t.maxScale||5,this.minScale=t.minScale||.1,this.rootNode.canvas=this,this.ro=new M.a((t,e)=>{for(const e of t){const{width:t,height:i}=e.contentRect;this.viewWidth=t,this.viewHeight=i,this.canvasWidth=t/this.canvasScale,this.canvasHeight=i/this.canvasScale,this.getBoundingClientRect()}this.mount(),this.render(),this.optimizeNode(),this.repaint=!0}),this.ro.observe(this.container),this.nativeEventInit(),this.setMode(t.mode||mt)}setZoom(t){this.canvasScale=t,this.canvasWidth=this.viewWidth/this.canvasScale,this.canvasHeight=this.viewHeight/this.canvasScale,this.render(),this.optimizeNode(),this.repaint=!0}nativeEventInit(){this.wrapper.addEventListener("click",this.handleClick),this.wrapper.addEventListener("dblclick",this.handleDblClick),this.wrapper.addEventListener("mousedown",this.handleMouseDown),this.wrapper.addEventListener("wheel",this.handleWheel),this.wrapper.addEventListener("dragover",this.handleDragOver),this.wrapper.addEventListener("drop",this.handleDrop),this.wrapper.addEventListener("contextmenu",this.handleContextMenu),this.wrapper.addEventListener("mouseenter",this.handleMouseEnter),document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("mouseup",this.handleMouseUp)}destroy(){this.wrapper.removeEventListener("click",this.handleClick),this.wrapper.removeEventListener("dblclick",this.handleDblClick),this.wrapper.removeEventListener("mousedown",this.handleMouseDown),this.wrapper.removeEventListener("wheel",this.handleWheel),this.wrapper.removeEventListener("dragover",this.handleDragOver),this.wrapper.removeEventListener("drop",this.handleDrop),this.wrapper.removeEventListener("contextmenu",this.handleContextMenu),this.wrapper.removeEventListener("mouseenter",this.handleMouseEnter),document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),this.ro.unobserve(this.container),this.ro.disconnect(),this.eventEmitter.clear(),this.unmount(),this.removeAllNode()}addNode(t){this.rootNode.hasChild(t)||(t.visible=t.isInRect(this.canvasVisibleRect),this.rootNode.addChild(t),this.repaint=!0)}setNodeTop(t){const e=t.parent;if(!e)return;const i=e.lastChild&&e.lastChild.zIndex||0;t.zIndex=Math.max(i,t.zIndex),e.removeChild(t,!1),e.addChild(t),t instanceof b&&(t.unmount(),t.mount()),this.repaint=!0}getActiveNodes(){return this.rootNode.getActiveDescendant()}removeNode(t,e=!0){if(!this.rootNode.hasDescendant(t))return;if(!t.parent)return;t.parent.removeChild(t,e),[...t.edges].forEach(t=>{this.removeEdge(t)}),this.repaint=!0}removeAllNode(t=!0){this.rootNode.removeAllChild(t)}addEdge(t){t.sourceNode.addEdge(t),t.targetNode.addEdge(t),t.canvas=this,this.repaint=!0}removeEdge(t){t.sourceNode.removeEdge(t),t.targetNode.removeEdge(t),t.canvas=void 0,this.repaint=!0}getActiveEdges(){const t=[],e=Math.random();return this.rootNode.getDescendantBF(i=>{i.edges.forEach(i=>{i.renderSign!==e&&(i.renderSign=e,i.active&&t.push(i))})}),t}getBoundingClientRect(){return this.containerClientRect=this.container.getBoundingClientRect(),this.containerClientRect}viewportToCanvasCoordinate(t){const{top:e,left:i}=this.containerClientRect||this.getBoundingClientRect();return t.clone().substract(new a(i,e))}canvasToViewportCoordinate(t){const{top:e,left:i}=this.containerClientRect||this.getBoundingClientRect();return t.clone().add(new a(i,e))}canvasToPixelCoordinate(t){return t.clone().scale(1/this.canvasScale)}pixelToCanvasCoordinate(t){return t.clone().scale(this.canvasScale)}viewportToPixelCoordinate(t){return this.canvasToPixelCoordinate(this.viewportToCanvasCoordinate(t))}pixelToViewportCoordinate(t){return this.canvasToViewportCoordinate(this.pixelToCanvasCoordinate(t))}get canvasVisibleRect(){return[new a(0,0),new a(this.canvasWidth,0),new a(this.canvasWidth,this.canvasHeight),new a(0,this.canvasHeight)]}zoomIn(t){t=t?this.viewportToCanvasCoordinate(t):new a(this.viewWidth/2,this.viewHeight/2);const e=this.canvasToPixelCoordinate(t);this.canvasScale+=.15,this.canvasScale=this.canvasScale>this.maxScale?this.maxScale:this.canvasScale;const i=this.canvasToPixelCoordinate(t).substract(e);this.canvasWidth=this.viewWidth/this.canvasScale,this.canvasHeight=this.viewHeight/this.canvasScale,this.rootNode.children.forEach(t=>{t.translate(i)}),this.optimizeNode(),this.render(),this.repaint=!0,this.eventEmitter.emit("canvas:zoom")}zoomOut(t){t=t?this.viewportToCanvasCoordinate(t):new a(this.viewWidth/2,this.viewHeight/2);const e=this.canvasToPixelCoordinate(t);this.canvasScale-=.15,this.canvasScale=this.canvasScale<this.minScale?this.minScale:this.canvasScale;const i=this.canvasToPixelCoordinate(t).substract(e);this.canvasWidth=this.viewWidth/this.canvasScale,this.canvasHeight=this.viewHeight/this.canvasScale,this.rootNode.children.forEach(t=>{t.translate(i)}),this.optimizeNode(),this.render(),this.repaint=!0,this.eventEmitter.emit("canvas:zoom")}setMode(t){if(!wt.hasMode(t))return void console.log(`该模式不存在:${t}`);let e=wt.use(this.interactionMode);e&&e.forEach(t=>{t.onUninstall(this)}),this.interactionMode=t,(e=wt.use(this.interactionMode))&&e.forEach(t=>{t.onInstall(this)})}optimizeNode(){if(!this.optimize)return;const t=this.canvasVisibleRect;this.rootNode.getDescendantBF().forEach(e=>{e.visible=e.isInRect(t)})}render(){Object.assign(this.domCanvas.style,{width:`${this.canvasWidth}px`,height:`${this.canvasHeight}px`,left:`${(this.viewWidth-this.canvasWidth)/2}px`,top:`${(this.viewHeight-this.canvasHeight)/2}px`,transform:`scale(${this.canvasScale})`}),this.graphCanvas.width=this.topCanvas.width=this.viewWidth,this.graphCanvas.height=this.topCanvas.height=this.viewHeight}mount(){this.mounted||(this.wrapper.appendChild(this.graphCanvas),this.wrapper.appendChild(this.domCanvas),this.container.appendChild(this.wrapper),this.eventEmitter.emit("canvas:mounted"),this.mounted=!0)}topCanvasMount(){this.topCanvasMounted||(this.wrapper.appendChild(this.topCanvas),this.topCanvasMounted=!0)}topCanvasUnmount(){this.topCanvasMounted&&(this.wrapper.removeChild(this.topCanvas),this.topCanvasMounted=!1)}unmount(){this.mounted&&(this.container.removeChild(this.wrapper),this.mounted=!1)}start(){this._running||(this._running=!0,this.loop())}stop(){this._running&&(cancelAnimationFrame(this._animationFrameId),this._running=!1)}loop(){this._running&&(this._animationFrameId=requestAnimationFrame(()=>{if(this.repaint){this.graphCanvasCtx.clearRect(0,0,this.viewWidth,this.viewHeight),this.graphCanvasCtx.save(),this.graphCanvasCtx.scale(this.canvasScale,this.canvasScale),this.renderNodes(),this.graphCanvasCtx.restore();const t=wt.use(this.interactionMode);t&&t.forEach(t=>{t.onUpdate(this)}),this.repaint=!1}this.loop()}))}renderNodes(){this.rootNode.getDescendantBF(t=>{t.edges.forEach(e=>{e.renderSign!==this._animationFrameId&&(e.sourceNode===t?e.targetNode.depth<=t.depth&&(e.render(),e.renderSign=this._animationFrameId):e.sourceNode.depth<=t.depth&&(e.render(),e.renderSign=this._animationFrameId))}),t instanceof w&&t.visible&&t.update(),t instanceof b&&(t.visible?(t.mount(),t.isUpdate&&(t.update(),t.isUpdate=!1)):t.unmount())}),this.virtualNode.edges.forEach(t=>{t.render()})}}s()(Ct,"config",{createLineOptions:{arrow:!0,text:""}});class Et extends C{get vertexes(){return this.getBoundingRect()}get joinPoint(){return this.getCenterPoint()}get boundingRect(){return this.getBoundingRect()}get boundingJoinPoints(){return this.getBoundingJoinPoints()}get centerPoint(){return this.getCenterPoint()}constructor(t){super(t),s()(this,"shapeType","rect"),s()(this,"width",void 0),s()(this,"height",void 0),s()(this,"minWidth",void 0),s()(this,"minHeight",void 0),s()(this,"collapseWidth",50),s()(this,"collapseHeight",50),s()(this,"text",void 0),this.width=t.width||100,this.height=t.height||100,this.minWidth=t.minWidth||30,this.minHeight=t.minHeight||30,this.text=t.text||""}getPosition(){if(this.isExpanded)return this.position;{const{x:t,y:e}=this.position;return new u(t+(this.width-this.collapseWidth)/2,e+(this.height-this.collapseHeight)/2)}}getWidth(){return this.isExpanded?this.width:this.collapseWidth}getHeight(){return this.isExpanded?this.height:this.collapseHeight}isPointIn(){const{canvas:t}=this;if(!t)return!1;if(!this.visible)return!1;if(!t.nativeEvent)return!1;const e=t.nativeEvent,i=t.viewportToPixelCoordinate(new u(e.clientX,e.clientY));return F.isPointInRect(i,this.getPosition(),this.getWidth(),this.getHeight())}getBoundingRect(){const t=this.getWidth(),e=this.getHeight(),{x:i,y:n}=this.getPosition();return[new u(i,n),new u(i+t,n),new u(i+t,n+e),new u(i,n+e)]}getBoundingJoinPoints(){const t=this.getWidth(),e=this.getHeight(),{x:i,y:n}=this.getPosition();return[new u(i+t/2,n),new u(i+t,n+e/2),new u(i+t/2,n+e),new u(i,n+e/2)]}getCenterPoint(){const t=this.getWidth(),e=this.getHeight(),{x:i,y:n}=this.getPosition();return new u(i+t/2,n+e/2)}isInRect(t){const e=this.getBoundingRect();return!(t[0].x>e[2].x)&&(!(t[2].x<e[0].x)&&(!(t[0].y>e[2].y)&&!(t[2].y<e[0].y)))}isWrappedInRect(t){const e=this.getBoundingRect();return t[0].x<=e[0].x&&t[0].y<=e[0].y&&t[2].x>=e[2].x&&t[2].y>=e[2].y}render(){this.$el.innerHTML=`<div style="height:100%;\n                                      display:flex;\n                                      align-items:center;\n                                      justify-content:center;\n                                      border:1px solid #29c1f8;\n                                      box-sizing: border-box;\n                                      font-size:12px;\n                                      user-select: none;\n                                      color:#29c1f8;">${this.text}</div>`}update(){const{x:t,y:e}=this.getPosition(),i=this.getWidth(),n=this.getHeight(),{active:s}=this;Object.assign(this.$el.style,{transform:`translate3d(${t}px,${e}px,0)`,width:`${i}px`,height:`${n}px`,boxShadow:s?"0 0 5px 0 rgba(255,0,0,0.8)":"none"})}}class Pt extends y{get boundingJoinPoints(){return this.getBoundingJoinPoints()}get boundingRect(){return this.getBoundingRect()}get centerPoint(){return this.getCenterPoint()}get vertexes(){return this.getBoundingRect()}constructor(t){super(t),s()(this,"shapeType","circle"),s()(this,"radius",void 0),s()(this,"minRadius",void 0),s()(this,"text",void 0),this.radius=t.radius||50,this.minRadius=t.minRadius||30,this.text=t.text||""}isPointIn(){const{canvas:t,centerPoint:e,radius:i}=this;if(!t)return!1;if(!this.visible)return!1;if(!t.nativeEvent)return!1;const n=t.nativeEvent,s=t.viewportToPixelCoordinate(new u(n.clientX,n.clientY));return F.isPointInCircle(s,e,i)}render(){const{radius:t,canvas:e,active:i}=this;if(!e)return;const n=2*t;this.cacheCanvas.width=n+2,this.cacheCanvas.height=n+2;const s=this.cacheCanvas.getContext("2d");s.beginPath(),s.arc(t+1,t+1,t,0,2*Math.PI),s.strokeStyle="#29c1f8",s.fillStyle="#fff",s.lineWidth=2,s.stroke(),s.fill(),this.text&&(s.textBaseline="middle",s.textAlign="center",s.font="14px serif",s.fillStyle="#29c1f8",s.fillText(this.text,t+1,t+1)),e.repaint=!0}update(){if(!this.canvas)return;const{graphCanvasCtx:t}=this.canvas,{x:e,y:i}=this.getPosition();t.save(),this.active&&(t.shadowBlur=5,t.shadowColor="rgba(255,0,0,0.8)"),t.drawImage(this.cacheCanvas,e-1,i-1),t.restore()}getBoundingJoinPoints(){return[]}getBoundingRect(){return[]}getCenterPoint(){return new u(0,0)}}N(Pt,[class{constructor(){s()(this,"position",void 0),s()(this,"radius",void 0)}getBoundingRect(){const{radius:t,position:{x:e,y:i}}=this,n=2*t;return[new u(e,i),new u(e+n,i),new u(e+n,i+n),new u(e,i+n)]}getBoundingJoinPoints(){const{radius:t,position:{x:e,y:i}}=this,n=2*t;return[new u(e+t,i),new u(e+n,i+t),new u(e+t,i+n),new u(e,i+t)]}getCenterPoint(){const{position:{x:t,y:e},radius:i}=this;return new u(t+i,e+i)}isInRect(t){const e=this.getBoundingRect();return!(t[0].x>e[2].x||t[2].x<e[0].x||t[0].y>e[2].y||t[2].y<e[0].y)}isWrappedInRect(t){const e=this.getBoundingRect();return t[0].x<=e[0].x&&t[0].y<=e[0].y&&t[2].x>=e[2].x&&t[2].y>=e[2].y}}]);var Nt=Pt;class Mt extends Nt{constructor(t){super(t),s()(this,"isGroup",!0),s()(this,"canResize",!0),"boolean"==typeof t.isExpanded&&(this.isExpanded=t.isExpanded)}render(){}update(){if(!this.canvas)return;const{graphCanvasCtx:t}=this.canvas,{x:e,y:i}=this.getPosition();t.beginPath(),t.arc(e+this.radius,i+this.radius,this.radius,0,2*Math.PI),t.save(),this.active&&(t.shadowBlur=5,t.shadowColor="rgba(255,0,0,0.8)"),t.strokeStyle="#066df2",t.stroke(),t.restore()}}class It{constructor(t,e,i){s()(this,"id",void 0),s()(this,"data",void 0),s()(this,"children",[]),s()(this,"parent",void 0),this.id=t,this.data=e,i&&i.addChild(this)}addChild(t){return this.addChildAt(t,this.children.length)}addChildAt(t,e){return e>=0&&e<=this.children.length?(t.parent=this,this.children.splice(e,0,t),t):void 0}getChildById(t){return this.children.find(e=>e.id===t)}getDescendantDF(t){const e=[],i=[...this.children];for(;i.length;){const n=i.pop();if(e.push(n),i.push(...n.children),t&&t(n))break}return e}getDescendantBF(t){const e=[],i=[...this.children];for(;i.length;){const n=i.shift();if(e.push(n),i.push(...n.children),t&&t(n))break}return e}get root(){let t=this;for(;void 0!==t.parent;)t=t.parent;return t}get depth(){let t=0,e=this;for(;void 0!==e.parent;)e=e.parent,t++;return t}get firstChild(){return this.children[0]}get lastChild(){return this.children[this.children.length-1]}}i.d(e,"Canvas",function(){return Ct}),i.d(e,"ContextMenu",function(){return v}),i.d(e,"EventEmitter",function(){return p}),i.d(e,"CanvasNode",function(){return w}),i.d(e,"DomNode",function(){return b}),i.d(e,"Edge",function(){return U}),i.d(e,"Node",function(){return m}),i.d(e,"MODE_DEFAULT",function(){return mt}),i.d(e,"MODE_VIEW",function(){return"mode.view"}),i.d(e,"MODE_CREATE_EDGE",function(){return"mode.create.edge"}),i.d(e,"MODE_CREATE_L",function(){return"mode.create.L"}),i.d(e,"MODE_AREA_PICK",function(){return"mode.area.pick"}),i.d(e,"MODE_BORDER",function(){return"mode.border"}),i.d(e,"SelectInteraction",function(){return nt}),i.d(e,"selectInteraction",function(){return st}),i.d(e,"CreateLineInteraction",function(){return Y}),i.d(e,"createEdgeInteraction",function(){return V}),i.d(e,"CreateLInteraction",function(){return et}),i.d(e,"createLInteraction",function(){return it}),i.d(e,"DragInteraction",function(){return R}),i.d(e,"dragInteraction",function(){return S}),i.d(e,"DropInteraction",function(){return k}),i.d(e,"dropInteraction",function(){return W}),i.d(e,"MenuInteraction",function(){return rt}),i.d(e,"menuInteration",function(){return at}),i.d(e,"MoveCanvasInteraction",function(){return L}),i.d(e,"moveCanvasInteraction",function(){return H}),i.d(e,"WheelZoomInteraction",function(){return B}),i.d(e,"wheelZoomInteraction",function(){return z}),i.d(e,"Interaction",function(){return D}),i.d(e,"AreaPickInteraction",function(){return ht}),i.d(e,"areaPickInteraction",function(){return ct}),i.d(e,"RectDomNode",function(){return Et}),i.d(e,"RectCanvasNode",function(){return dt}),i.d(e,"CircleCanvasNode",function(){return Pt}),i.d(e,"RectGroup",function(){return ut}),i.d(e,"CircleGroup",function(){return Mt}),i.d(e,"Line",function(){return J}),i.d(e,"L",function(){return Q}),i.d(e,"Math2d",function(){return j}),i.d(e,"Vector2d",function(){return a}),i.d(e,"throttle",function(){return E}),i.d(e,"imgLoad",function(){return P}),i.d(e,"applyMixins",function(){return N}),i.d(e,"TreeNode",function(){return It})}])});